var ci=Object.create;var Vt=Object.defineProperty;var ui=Object.getOwnPropertyDescriptor;var pi=Object.getOwnPropertyNames;var hi=Object.getPrototypeOf,gi=Object.prototype.hasOwnProperty;var zt=(c,t)=>()=>(t||c((t={exports:{}}).exports,t),t.exports);var mi=(c,t,n,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of pi(t))!gi.call(c,l)&&l!==n&&Vt(c,l,{get:()=>t[l],enumerable:!(d=ui(t,l))||d.enumerable});return c};var vi=(c,t,n)=>(n=c!=null?ci(hi(c)):{},mi(t||!c||!c.__esModule?Vt(n,"default",{value:c,enumerable:!0}):n,c));var jt=zt(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.roundAction=te.getSpeed=te.getActionGroups=void 0;var fi=function(c){var t=[],n=-1,d=-1;return c.forEach(function(l,g){if(g===0){t.push([l]),n++;return}if(g===1){t[n].push(l),d=Math.max(250,l.at-c[g-1].at);return}var L=l.at-c[g-1].at;L>5*d?(t.push([l]),n++):t[n].push(l),d=Math.max(250,L)}),t};te.getActionGroups=fi;var bi=function(c,t){if(!c||!t||c.at===t.at)return 0;try{if(t.at<c.at){var n=t;t=c,c=n}return 1e3*(Math.abs(t.pos-c.pos)/Math.abs(t.at-c.at))}catch(d){return console.error("Failed on actions",c,t,d),0}};te.getSpeed=bi;var Si=function(c){var t={at:Math.max(0,Math.round(c.at)),pos:Math.max(0,Math.min(100,Math.round(c.pos)))};return c.subActions&&(t.subActions=c.subActions.map(function(n){return te.roundAction(n)})),c.type&&(t.type=c.type),t};te.roundAction=Si});var qt=zt(X=>{"use strict";var Se=X&&X.__assign||function(){return Se=Object.assign||function(c){for(var t,n=1,d=arguments.length;n<d;n++){t=arguments[n];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(c[l]=t[l])}return c},Se.apply(this,arguments)};Object.defineProperty(X,"__esModule",{value:!0});X.convertFunscriptToCsv=X.addFunscriptMetadata=X.getFunscriptFromString=void 0;var pt=jt(),Li=function(c){var t=JSON.parse(c);return X.addFunscriptMetadata(t)};X.getFunscriptFromString=Li;var yi=function(c){var t=Se({},c);t.actions=t.actions.sort(function(l,g){return l.at-g.at}).map(pt.roundAction);var n=t.actions.slice(-1)[0].at,d=t.actions.reduce(function(l,g,L){if(L===0)return l;var y=pt.getSpeed(t.actions[L-1],t.actions[L]);return l+y},0)/(t.actions.length-1);return t.metadata=Se(Se({},t.metadata),{duration:n,average_speed:d}),t};X.addFunscriptMetadata=yi;var wi=function(c){var t=JSON.parse(c),n=t.actions.map(function(l){var g=pt.roundAction(l);return g.at+","+g.pos}).join(`
`),d=new Blob([n],{type:"text/plain"});return d};X.convertFunscriptToCsv=wi});import*as ie from"buttplug";import{ButtplugWasmClientConnector as Nt}from"buttplug-wasm";var Be=class{_client=new ie.ButtplugClient;_deviceRefleshedEvents=[];UFOTWReverseLR=!1;Devices={Viberators:[],Rotators:[],Linears:[],UFOTW:[]};constructor(){console.log("buttplugOperator constructed."),this._client.addListener("deviceadded",async t=>{console.log(`device added: ${t.name}`),this.ParseDeviceList()}),this._client.addListener("deviceremoved",t=>{console.log(`device removed: ${t.name}`),this.ParseDeviceList()})}async connectWasm(){return Nt.activateLogging(),this.connect(new Nt)}async connectWebsocket(t){let n=new ie.ButtplugBrowserWebsocketClientConnector(t);return this.connect(n)}async connect(t){try{await this._client.connect(t)}catch(n){return console.log(`${n}`),n instanceof ie.ButtplugError&&(console.log("this is a buttplug error"),n instanceof ie.ButtplugClientConnectorException?console.log("This is a connector error"):console.log("Was another type of error")),!1}return!0}AddDevicesRefleshedEvents(t){this._deviceRefleshedEvents.push(t)}ParseDeviceList(){this.Devices.Viberators.splice(0),this.Devices.Rotators.splice(0),this.Devices.Linears.splice(0),this.Devices.UFOTW.splice(0);for(let t of this._client.devices){t.name==="Vorze UFO TW"?(this.Devices.UFOTW.push(t),t.rotate([[.3,!0],[.3,!1]]),setTimeout(()=>{t.stop()},600)):t.vibrateAttributes.length>0?(this.Devices.Viberators.push(t),t.vibrate(.5),setTimeout(()=>{t.stop()},600)):t.rotateAttributes.length>0?(this.Devices.Rotators.push(t),t.rotate(.5,!0),setTimeout(()=>{t.stop()},600)):t.linearAttributes.length>0&&(this.Devices.Linears.push(t),t.linear(0,1e3),setTimeout(()=>{t.linear(.5,1e3)},1e3),setTimeout(()=>{t.linear(0,1e3)},2e3)),console.log("Viberators:");for(let n of this.Devices.Viberators)console.log("  "+n.name);console.log("Rotators:");for(let n of this.Devices.Rotators)console.log("  "+n.name);console.log("Linears:");for(let n of this.Devices.Linears)console.log("  "+n.name)}for(let t of this._deviceRefleshedEvents)t()}StopAllDevices(){for(let t of this.Devices.Viberators)t.stop();for(let t of this.Devices.Rotators)t.stop();for(let t of this.Devices.Linears)t.stop();for(let t of this.Devices.UFOTW)t.stop()}SendViberateMsg(t){this.Devices.Viberators.forEach(n=>{n.vibrate(t)})}SendRotateMsg(t,n){this.Devices.Rotators.forEach(d=>{d.rotate(t,n)})}SendLinearMsg(t,n){this.Devices.Linears.forEach(d=>{d.linear(t,n)})}SendUFOTWMsg(t,n,d,l){this.Devices.UFOTW.forEach(g=>{this.UFOTWReverseLR?g.rotate([[d,l],[t,n]]):g.rotate([[t,n],[d,l]])})}async ConnectDevice(){this._client.connected?await this._client.startScanning():console.log("buttplug client is not connected.")}};var fe;(R=>{class c{Milliseconds=0;Power=0;constructor(M,O){this.Milliseconds=M,O<0?this.Power=0:O>1e3?this.Power=1e3:this.Power=O}get ButtPower(){return this.Power/1e3}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let M=Math.floor(this.Milliseconds/1e3),O=Math.floor(M/60),_=Math.floor(O/60),U=String(M%60).padStart(2,"0"),N=String(O%60).padStart(2,"0");return`${String(_).padStart(2,"0")}:${N}:${U}`}toString(){return`Time: ${this.Milliseconds}, Power: ${this.ButtPower}`}}R.ScriptLine=c;let t=/^([0-9]+)(\.[0-9]{1,2})?,(1000|[0-9]+)$/;function n(w){let O=w.replace(/\r\n|\r/g,`
`).split(/\n/);O.slice(-1)[0]===""&&O.pop();let _=!0;for(let U=0;U<O.length;U++)if(!O[U].match(t)){_=!1;break}return _}R.Validate=n;function d(w){let O=w.replace(/\r\n|\r/g,`
`).split(/\n/),_=[];for(let U of O){let N=U.match(t);if(N){let Q=Number(N[1])*1e3;if(N[2]){let ae=N[2].replace(".",""),de;ae.length==1?de=Number(ae)*10:de=Number(ae),Q+=de*10}let oe=Number(N[3]),le=new c(Q,oe);_.push(le)}}return console.log("script start time: "+_[0].HHMMSS),_}R.RawScriptToLines=d;function l(w){let M=[];for(let _ of w){let U=_.Seconds;M[U]||(M[U]=[]),M[U].push(_)}return M}R.SplitLines=l;function g(w){let M=d(w);return l(M)}R.LoadScript=g;let L=[new c(500,800),new c(600,0),new c(1500,400),new c(1600,0),new c(2500,800),new c(2600,0),new c(3500,400),new c(3600,0),new c(4500,800),new c(4600,0),new c(5500,400),new c(5600,0),new c(6500,800),new c(6600,0),new c(7500,400),new c(7600,0)];R.TestScript=l(L)})(fe||={});var be;(g=>{class c{Milliseconds=0;Clockwise=!0;Power=0;get ButtPower(){return this.Power/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let y=Math.floor(this.Milliseconds/1e3),R=Math.floor(y/60),w=Math.floor(R/60),M=String(y%60).padStart(2,"0"),O=String(R%60).padStart(2,"0");return`${String(w).padStart(2,"0")}:${O}:${M}`}constructor(y,R,w){this.Milliseconds=y,this.Clockwise=R,w<0?this.Power=0:w>100?this.Power=100:this.Power=w}toString(){return`Time: ${this.Milliseconds}, Clockwise: ${this.Clockwise} Power: ${this.ButtPower}`}}g.ScriptLine=c;let t=/^([0-9]+),(0|1),(100|[0-9]{1,2})$/;function n(L){let R=L.replace(/\r\n|\r/g,`
`).split(/\n/);R.slice(-1)[0]===""&&R.pop();let w=!0;for(let M=0;M<R.length;M++)if(!R[M].match(t)){w=!1;break}return w}g.Validate=n;function d(L){let R=L.replace(/\r\n|\r/g,`
`).split(/\n/),w=[];for(let M of R){let O=M.match(t);if(O){let _=Number(O[1])*100,U=O[2]==="1",N=Number(O[3]),Q=new c(_,U,N);w.push(Q)}}return console.log("script start time: "+w[0].HHMMSS),w}g.RawScriptToLines=d;function l(L){let y=[];for(let w of L){let M=w.Seconds;y[M]||(y[M]=[]),y[M].push(w)}return y}g.SplitLines=l})(be||={});var ht=vi(qt(),1),Pe=class{Title;Origin;Ranged;Splitted;get OriginMin(){return this.getMin(this.Origin)}get OriginMax(){return this.getMax(this.Origin)}get RangedMin(){return this.getMin(this.Ranged)}get RangedMax(){return this.getMax(this.Ranged)}constructor(t,n){this.Title=t;let d=(0,ht.getFunscriptFromString)(n),l=this.ConvertJsonToScript(d);console.log("funscript loaded. lines: "+l.length),console.log("script start time: "+l[0].HHMMSS),this.Origin=l,this.Ranged=l,this.Splitted=this.SplitLines(l)}ConvertJsonToScript(t){let n=t.actions,d=[],l=0;for(let g of n){let L=g.at-l;d.push(new Fe(l,g.pos,L)),l=g.at}return d}SetRange(t,n){let d=[];for(let l of this.Origin){let g=this.normalize(l.Position,this.OriginMin,this.OriginMax,t,n),L=new Fe(l.Milliseconds,g,l.Duration);d.push(L)}this.Ranged=d,this.Splitted=this.SplitLines(d);for(let l=0;l<10;l++)console.log(this.Ranged[l]);console.log("newmin: "+this.getMin(this.Ranged)),console.log("newmax: "+this.getMax(this.Ranged)),console.log("splitted.length: "+this.Splitted.length)}Validate(t){try{let n=(0,ht.getFunscriptFromString)(t);return!0}catch{return console.log("Loading funscript is failed."),!1}}getMin(t){let n=t.map(l=>l.Position),d=(l,g)=>Math.min(l,g);return n.reduce(d)}getMax(t){let n=t.map(l=>l.Position),d=(l,g)=>Math.max(l,g);return n.reduce(d)}SplitLines(t){let n=[];for(let l of t){let g=l.Seconds;n[g]||(n[g]=[]),n[g].push(l)}return n}normalize(t,n,d,l,g){if(n>d)throw new RangeError("oldMin is greater than oldMax.");if(l>g)throw new RangeError("newMin is greater than newMax.");t>d&&(t=d),t<n&&(t=n);let L=d-n,y=g-l;return(t-n)*y/L+l}},Fe=class{Milliseconds=0;Position=0;Duration=0;get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get ButtPosition(){return this.Position/100}get HHMMSS(){let t=this.Seconds,n=Math.floor(t/60),d=Math.floor(n/60),l=String(t%60).padStart(2,"0"),g=String(n%60).padStart(2,"0");return`${String(d).padStart(2,"0")}:${g}:${l}`}constructor(t,n,d){if(t<0)throw new RangeError("milliseconds does not accept negative values.");if(n<0||n>100)throw new RangeError("position does not accept values outside the range 0 to 100.");if(d<0)throw new RangeError("milliseconds does not accept negative values.");this.Milliseconds=t,this.Duration=d,this.Position=n}toString(){return`Time: ${this.Milliseconds}, Positon: ${this.Position}, Duration: ${this.Duration}`}};var Le;(g=>{class c{Milliseconds=0;LeftClockwise=!0;LeftPower=0;RightClockwise=!0;RightPower=0;get LeftButtPower(){return this.LeftPower/100}get RightButtPower(){return this.RightPower/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let y=Math.floor(this.Milliseconds/1e3),R=Math.floor(y/60),w=Math.floor(R/60),M=String(y%60).padStart(2,"0"),O=String(R%60).padStart(2,"0");return`${String(w).padStart(2,"0")}:${O}:${M}`}constructor(y,R,w,M,O){this.Milliseconds=y,this.LeftClockwise=R,this.RightClockwise=M,w<0?this.LeftPower=0:w>100?this.LeftPower=100:this.LeftPower=w,O<0?this.RightPower=0:O>100?this.RightPower=100:this.RightPower=O}toString(){return`Time: ${this.Milliseconds}, LeftClockwise: ${this.LeftClockwise} LeftPower: ${this.LeftButtPower}, LeftClockwise: ${this.RightClockwise} LeftPower: ${this.RightButtPower}`}}g.ScriptLine=c;let t=/^([0-9]+),(0|1),(100|[0-9]{1,2}),(0|1),(100|[0-9]{1,2})$/;function n(L){let R=L.replace(/\r\n|\r/g,`
`).split(/\n/);R.slice(-1)[0]===""&&R.pop();let w=!0;for(let M=0;M<R.length;M++)if(!R[M].match(t)){w=!1;break}return w}g.Validate=n;function d(L){let R=L.replace(/\r\n|\r/g,`
`).split(/\n/),w=[];for(let M of R){let O=M.match(t);if(O){let _=Number(O[1])*100,U=O[2]==="1",N=Number(O[3]),Q=O[4]==="1",oe=Number(O[5]),le=new c(_,U,N,Q,oe);w.push(le)}}return console.log("script start time: "+w[0].HHMMSS),w}g.RawScriptToLines=d;function l(L){let y=[];for(let w of L){let M=w.Seconds;y[M]||(y[M]=[]),y[M].push(w)}return y}g.SplitLines=l})(Le||={});var $e=class{_buttplugOperator;_previousSeconds=0;_timerIDs=new Set;Offset=0;Scripts={TimeRoter:void 0,Vorze_SA:void 0,Funscript:void 0,UFOTW:void 0};constructor(t){this._buttplugOperator=t}LoadScript(t,n){if(console.log("path: "+n),n.endsWith(".funscript"))return this.Scripts.Funscript=new Pe(n,t),!0;if(fe.Validate(t)){let d=fe.RawScriptToLines(t);return this.Scripts.TimeRoter={Script:d,Splitted:fe.SplitLines(d),Title:n},console.log("timeroter script loaded. lines: "+d.length),!0}else if(Le.Validate(t)){let d=Le.RawScriptToLines(t);return this.Scripts.UFOTW={Script:d,Splitted:Le.SplitLines(d),Title:n},console.log("UFOTW script loaded. lines: "+d.length),!0}else if(be.Validate(t)){let d=be.RawScriptToLines(t);return this.Scripts.Vorze_SA={Script:d,Splitted:be.SplitLines(d),Title:n},console.log("Vorze_SA script loaded. lines: "+d.length),!0}else return!1}Stop(){this._previousSeconds=0,this._buttplugOperator.StopAllDevices(),this._timerIDs.forEach(t=>{clearTimeout(t)}),this._timerIDs.clear()}TimeUpdate(t){let n=t+this.Offset,d=Math.trunc(n);d!==this._previousSeconds&&(this.OperateTimeRoterScript(n),this.OperateVorzeSAScript(n),this.OperateFunscript(n),this.OperateUFOTWScript(n),this._previousSeconds=d)}SetFunscriptRange(t,n){this.Scripts.Funscript?.SetRange(t,n)}OperateTimeRoterScript(t){if(!this.Scripts.TimeRoter)return;let n=Math.trunc(t),d=this.Scripts.TimeRoter.Splitted;this._buttplugOperator.Devices.Viberators.length>0&&n!==this._previousSeconds&&d[n+1]&&d[n+1].forEach(l=>{let g=l.Milliseconds-Math.trunc(t*1e3),L=`send ViberateMsg: ${l.toString()}`;setTimeout(()=>console.log(L),g);let y=window.setTimeout(()=>{this._buttplugOperator.SendViberateMsg(l.ButtPower)},g);this._timerIDs.add(y),setTimeout(()=>{this._timerIDs.delete(y)},3e3)})}OperateVorzeSAScript(t){if(!this.Scripts.Vorze_SA)return;let n=Math.trunc(t),d=this.Scripts.Vorze_SA.Splitted;this._buttplugOperator.Devices.Rotators.length>0&&n!==this._previousSeconds&&d[n+1]&&d[n+1].forEach(l=>{let g=l.Milliseconds-Math.trunc(t*1e3),L=`send RotateMsg: ${l.toString()}`;setTimeout(()=>console.log(L),g);let y=window.setTimeout(()=>{this._buttplugOperator.SendRotateMsg(l.ButtPower,l.Clockwise)},g);this._timerIDs.add(y),setTimeout(()=>{this._timerIDs.delete(y)},3e3)})}OperateUFOTWScript(t){if(!this.Scripts.UFOTW)return;let n=Math.trunc(t),d=this.Scripts.UFOTW.Splitted;this._buttplugOperator.Devices.UFOTW.length>0&&n!==this._previousSeconds&&d[n+1]&&d[n+1].forEach(l=>{let g=l.Milliseconds-Math.trunc(t*1e3),L=`send RotateMsg: ${l.toString()}`;setTimeout(()=>console.log(L),g);let y=window.setTimeout(()=>{this._buttplugOperator.SendUFOTWMsg(l.LeftButtPower,l.LeftClockwise,l.RightButtPower,l.RightClockwise)},g);this._timerIDs.add(y),setTimeout(()=>{this._timerIDs.delete(y)},3e3)})}OperateFunscript(t){if(!this.Scripts.Funscript)return;let n=Math.trunc(t),d=t*1e3,l=this.Scripts.Funscript.Splitted;this._buttplugOperator.Devices.Linears.length>0&&n!==this._previousSeconds&&l[n+1]&&l[n+1].forEach(g=>{let L=g.Milliseconds-d,y=`send LinearMsg: ${g.toString()}`;setTimeout(()=>console.log(y),L);let R=window.setTimeout(()=>{this._buttplugOperator.SendLinearMsg(g.ButtPosition,g.Duration)},L);this._timerIDs.add(R),setTimeout(()=>{this._timerIDs.delete(R)},3e3)})}};var _e=class{Player=document.getElementById("player");MediaNameSpan=document.getElementById("mediaNameSpan");OffsetInput=document.getElementById("offset");UFOTWreverseLRli=document.getElementById("UFOTWreverseLRli");UFOTWreverseLRCheckbox=document.getElementById("UFOTWreverseLRCheckbox");VibDeviceList=document.getElementById("VibDeviceList");RotatorDeviceList=document.getElementById("RotatorDeviceList");LinearDeviceList=document.getElementById("LinearDeviceList");UFOTWDeviceList=document.getElementById("UFOTWDeviceList");TimeRoterScriptList=document.getElementById("TimeRoterScriptList");VorzeSAScriptList=document.getElementById("VorzeSAScriptList");FunscriptList=document.getElementById("FunscriptList");UFOTWScriptList=document.getElementById("UFOTWScriptList");ScriptInput=document.getElementById("scriptInput");MediaInput=document.getElementById("mediaInput");ConnectServerButton=document.getElementById("connectServerButton");ConnectDeviceButton=document.getElementById("connectDeviceButton");ConnectStatusSpan=document.getElementById("connectStatus");FunscriptSlider;AppendToList(t,n){let d=document.createElement("li"),l=document.createElement("span");return l.className="name",l.innerText=n,d.appendChild(l),t.appendChild(d),d}AppendVibDeviceList(t){this.AppendToList(this.VibDeviceList,t)}AppendRotatorDeviceList(t){this.AppendToList(this.RotatorDeviceList,t)}AppendLinearDeviceList(t){this.AppendToList(this.LinearDeviceList,t)}AppendUFOTWDeviceList(t){this.AppendToList(this.UFOTWDeviceList,t)}AppendTimeRoterScriptList(t){this.AppendToList(this.TimeRoterScriptList,t)}AppendVorzeSAScriptList(t){this.AppendToList(this.VorzeSAScriptList,t)}AppendUFOTWScriptList(t){this.AppendToList(this.UFOTWScriptList,t)}AppendFunscriptList(t){let n=this.AppendToList(this.FunscriptList,t),d=document.createElement("slider-container");n.appendChild(d),d.InitializeSlider(),this.FunscriptSlider=d}ClearDeviceLists(){this.VibDeviceList.innerHTML="",this.RotatorDeviceList.innerHTML="",this.LinearDeviceList.innerHTML=""}ClearScriptLists(){this.TimeRoterScriptList.innerHTML="",this.VorzeSAScriptList.innerHTML="",this.FunscriptList.innerHTML="",this.UFOTWScriptList.innerHTML=""}AddFunscriptSliderUpdateEvent(t){let n=this.FunscriptSlider;n?.addEventListener("mouseup",()=>{t(n.range_min,n.range_max)})}};var He=class{ButtplugOperator;ScriptOperator;UI;constructor(){this.ButtplugOperator=new Be,this.ScriptOperator=new $e(this.ButtplugOperator),this.UI=new _e,this.addEvents()}async ConnectWasm(){let t=this.UI.ConnectStatusSpan;t.innerText="Buttplug\u6E96\u5099\u4E2D..",await this.ButtplugOperator.connectWasm()?t.innerText="Buttplug\u6E96\u5099\u5B8C\u4E86":t.innerText="Buttplug\u6E96\u5099\u306B\u5931\u6557\u3057\u307E\u3057\u305F"}async ConnectServer(){let t=document.getElementById("serverURL"),n=this.UI.ConnectStatusSpan;n.innerText="\u63A5\u7D9A\u4E2D...",await this.ButtplugOperator.connectWebsocket("ws://"+t.value)?n.innerText="\u63A5\u7D9A\u6210\u529F: "+t.value:n.innerText="\u63A5\u7D9A\u5931\u6557"}RefleshDeviceLists(){let t=this.UI;t.ClearDeviceLists();for(let n of this.ButtplugOperator.Devices.Viberators)t.AppendVibDeviceList(n.name);for(let n of this.ButtplugOperator.Devices.Rotators)t.AppendRotatorDeviceList(n.name);for(let n of this.ButtplugOperator.Devices.Linears)t.AppendLinearDeviceList(n.name);if(this.ButtplugOperator.Devices.UFOTW.length>0){for(let n of this.ButtplugOperator.Devices.UFOTW)t.AppendUFOTWDeviceList(n.name);t.UFOTWreverseLRli.style.display="list-item"}else t.UFOTWreverseLRli.style.display="none"}RefleshScriptLists(){let t=this.UI;t.ClearScriptLists();let n=this.ScriptOperator.Scripts.TimeRoter,d=this.ScriptOperator.Scripts.Vorze_SA,l=this.ScriptOperator.Scripts.Funscript,g=this.ScriptOperator.Scripts.UFOTW;n&&t.AppendTimeRoterScriptList(n.Title),d&&t.AppendVorzeSAScriptList(d.Title),g&&t.AppendUFOTWScriptList(g.Title),l&&(t.AppendFunscriptList(l.Title),t.FunscriptSlider.range_min=l.RangedMin,t.FunscriptSlider.range_max=l.RangedMax,t.FunscriptSlider.addEventListener("mouseup",()=>{let L=t.FunscriptSlider.range_min,y=t.FunscriptSlider.range_max;l.SetRange(L,y)}))}LoadScript(){let t=this.UI.ScriptInput.files[0];if(t!=null){let n=new FileReader;n.readAsText(t),n.onload=()=>{n.result&&this.ScriptOperator.LoadScript(n.result,t.name)&&this.RefleshScriptLists()},n.onerror=()=>{console.log(n.error)}}}LoadMedia(){let t=this.UI,n=t.MediaInput.files;n&&(n[0].type.startsWith("video/")?(t.Player.src=URL.createObjectURL(n[0]),t.Player.style.height="auto",t.MediaNameSpan.innerText=n[0].name):n[0].type.startsWith("audio/")?(t.Player.src=URL.createObjectURL(n[0]),t.Player.style.height="3em",t.MediaNameSpan.innerText=n[0].name):t.MediaNameSpan.innerText="\u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306F\u518D\u751F\u3067\u304D\u307E\u305B\u3093: "+n[0].name,t.MediaInput.files=null)}addEvents(){console.log("addEvent() called.");let t=this.UI;t.Player.addEventListener("timeupdate",()=>{t.Player.paused||this.ScriptOperator.TimeUpdate(t.Player.currentTime)}),t.Player.addEventListener("pause",()=>this.ScriptOperator.Stop()),t.Player.addEventListener("ended",()=>this.ScriptOperator.Stop()),t.ScriptInput.addEventListener("input",()=>{this.LoadScript()}),document.getElementById("scriptButton").addEventListener("click",()=>{t.ScriptInput?.click()}),t.MediaInput.addEventListener("input",()=>{this.LoadMedia()}),document.getElementById("mediaButton")?.addEventListener("click",()=>{t.MediaInput.click()}),t.UFOTWreverseLRCheckbox.addEventListener("change",()=>{this.ButtplugOperator.UFOTWReverseLR=this.UI.UFOTWreverseLRCheckbox.checked}),t.OffsetInput.addEventListener("change",()=>{this.ScriptOperator.Offset=Number(t.OffsetInput.value)}),t.ConnectDeviceButton.addEventListener("click",async()=>{await this.ButtplugOperator.ConnectDevice()}),t.ConnectServerButton!=null?t.ConnectServerButton?.addEventListener("click",async()=>this.ConnectServer()):this.ConnectWasm(),this.ButtplugOperator.AddDevicesRefleshedEvents(()=>this.RefleshDeviceLists())}};(()=>{var c=Object.defineProperty,t=Math.pow,n=(e,i,o)=>i in e?c(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o,d=(e,i,o)=>(n(e,typeof i!="symbol"?i+"":i,o),o),l=(e,i)=>` ${i&&i.length>0?i.map(o=>`<link rel="stylesheet" href="${o}" />`).join(""):""} <style> ${e} </style> <div class="range-slider-box"> <div class="row"> <div id="range-slider" class="range-slider"> <div class="container"> <div class="panel"></div> <div class="panel-fill"></div> <div class="container"> <div class="pointer" tabindex="0" role="slider"> <div class="pointer-shape"></div> </div> </div> </div> </div> </div> </div>`,g=":host{--width:300px;--height:.25rem;--opacity:.4;--panel-bg:#cbd5e1;--panel-bg-hover:#94a3b8;--panel-bg-fill:#475569;--panel-bg-border-radius:1rem;--pointer-width:1rem;--pointer-height:1rem;--pointer-bg:#fff;--pointer-bg-hover:#dcdcdc;--pointer-bg-focus:#dcdcdc;--pointer-shadow:0 0 2px rgba(0,0,0,0.8);--pointer-shadow-hover:0 0 2px #000;--pointer-shadow-focus:var(--pointer-shadow-hover);--pointer-border:1px solid hsla(0,0%,88%,0.5);--pointer-border-hover:1px solid #94a3b8;--pointer-border-focus:var(--pointer-border-hover);--pointer-border-radius:100%;--animate-onclick:.3s}:host{max-width:100%}.range-slider-box{display:flex;position:relative;flex-direction:column}.range-slider{position:relative;width:var(--width,100%);height:var(--height,0.25rem);touch-action:none;max-width:100%;box-sizing:border-box;cursor:pointer}.row{width:100%;display:flex;align-items:center}.range-slider.disabled{opacity:var(--opacity,0.4);cursor:default}.pointer.disabled{-webkit-filter:brightness(0.8);filter:brightness(0.8);cursor:default}.range-slider *{box-sizing:border-box}.container{position:absolute;width:100%;height:100%}.panel{position:absolute;z-index:10;width:100%;height:100%;background:var(--panel-bg,#2d4373);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;transition:.3s all ease}.panel-fill{background:var(--panel-bg-fill,#000);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;height:100%;position:absolute;z-index:10}.panel:hover{background:var(--panel-bg-hover,#5f79b7)}.disabled .panel:hover{background:var(--panel-bg,#5f79b7)}.pointer{position:absolute;z-index:20;outline:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;box-shadow:var(--pointer-shadow);border:var(--pointer-border);border-radius:var(--pointer-border-radius,100%);-webkit-transform:translateX(-50%);transform:translateX(-50%);width:var(--pointer-width,15px);height:var(--pointer-height,15px);transition:.3s all ease}.pointer-shape:hover{background:var(--pointer-bg-hover,#fff);background-size:contain;border:var(--pointer-border-hover);box-shadow:var(--pointer-shadow-hover)}.disabled .pointer-shape:hover{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.pointer:focus .pointer-shape{background:var(--pointer-bg-focus,#fff);background-size:contain;border:var(--pointer-border-focus);box-shadow:var(--pointer-shadow-focus)}.disabled .pointer:focus .pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.type-vertical .range-slider{--width:.25rem;--height:300px;max-height:100%}.type-vertical .range-slider .pointer{left:50%}.type-vertical .range-slider .panel-fill{width:100%}.type-vertical.range-slider-box{flex-direction:row}.type-vertical .row{flex-direction:column}.animate-on-click .pointer,.animate-on-click .panel-fill{transition:all var(--animate-onclick)}.range-dragging .panel-fill{cursor:move}",L="pointers-overlap",y="pointers-min-distance",R="pointers-max-distance",w="range-dragging",M="data",O="min",_="max",U="step",N="round",Q="type",oe="theme",le="rtl",ae="btt",de="disabled",gt="keyboard-disabled",mt="mousewheel-disabled",Jt="slider-width",Yt="slider-height",Gt="slider-radius",Kt="slider-bg",Xt="slider-bg-hover",Qt="slider-bg-fill",Zt="pointer-width",er="pointer-height",tr="pointer-radius",rr="pointer-bg",ir="pointer-bg-hover",nr="pointer-bg-focus",sr="pointer-shadow",or="pointer-shadow-hover",lr="pointer-shadow-focus",ar="pointer-border",dr="pointer-border-hover",cr="pointer-border-focus",vt="animate-onclick",ur="css-links",G="vertical",ce="horizontal",Ue=(e,i,o,s,u)=>{let f=i-e;return f===0?o:(s-o)*(u-e)/f+o},ee=e=>!isNaN(parseFloat(e))&&isFinite(e),H=(e,i)=>ee(e)?Number(e):i,ft=(e,i)=>i===0?0:Math.round(e/i)*i,pr=(e,i=1/0)=>{if(i===1/0)return e;let o=t(10,i);return Math.round(e*o)/o},V=e=>e==null?!1:typeof e=="boolean"?e:e.trim().toLowerCase()==="true",hr=(e,i)=>{e.dispatchEvent(new CustomEvent("onPointerClicked",{detail:{$pointer:i}}))},gr=(e,i)=>{e.dispatchEvent(new CustomEvent("onMouseDown",{detail:{nativeEvent:i}}))},mr=(e,i)=>{e.dispatchEvent(new CustomEvent("onMouseUp",{detail:{nativeEvent:i}}))},vr=(e,i)=>{e.dispatchEvent(new CustomEvent("onKeyDown",{detail:{nativeEvent:i}}))},fr=(e,i)=>{if(!i||i.length<=0)return;let o=i.map(u=>ee(u)?H(u,u):u),s={values:o||[]};s.value=o[0],s.value0=o[0],s.value1=o[0];for(let u=1;u<o.length;u++)s[`value${u+1}`]=o[u];e.dispatchEvent(new CustomEvent("change",{detail:s}))},We=(e,i,o)=>{let s=0,u,f,T,p,h=!1,x=(S,B,W,I,P,F)=>{let j=s;W!==void 0&&S>W&&(S=W),B!==void 0&&S<B&&(S=B),s=S;let q=s;return(I===G&&F||I===ce&&P)&&(q=100-q),I===G?i.style.top=`${q}%`:i.style.left=`${q}%`,j!==s},E=S=>S===i||i.contains(S),v=(S,B,W,I)=>{u=S,f=B,T=W,p=I},C=S=>{h=S,i.classList.toggle("disabled",h),h?i.setAttribute("aria-disabled","true"):i.hasAttribute("aria-disabled")&&i.removeAttribute("aria-disabled")},Y=(S,B)=>{B==null?i.removeAttribute(S):i.setAttribute(S,B)},z=S=>i.getAttribute(S),b=S=>{if(!h){switch(S.key){case"ArrowLeft":{S.preventDefault(),typeof u=="function"&&u(o);break}case"ArrowRight":{S.preventDefault(),typeof f=="function"&&f(o);break}case"ArrowUp":{S.preventDefault(),typeof T=="function"&&T(o);break}case"ArrowDown":{S.preventDefault(),typeof p=="function"&&p(o);break}}vr(e,S)}},D=()=>{h||hr(e,i)};return i.className=`pointer pointer-${o}`,i.addEventListener("keydown",b),i.addEventListener("click",D),{$pointer:i,get percent(){return s},get disabled(){return h},set disabled(S){C(S)},updatePosition:x,isClicked:E,setCallbacks:v,setAttr:Y,getAttr:z,destroy:()=>{i.removeEventListener("keydown",b),i.removeEventListener("click",D),i.remove()}}},br=e=>{if(e==null)return;if(Array.isArray(e))return e;if(e.trim()==="")return;let i=e.split(","),o=[],s=!0;for(let u=0;u<i.length;u++){let f=i[u].trim();f!==""&&(o.push(f),ee(f)||(s=!1))}return s?o.map(u=>Number(u)):o},Sr=(e,i)=>i?i.findIndex(o=>o===e||o.toString().trim()===e.toString().trim()):-1,Lr=e=>({updatePosition:(i,o,s,u)=>{if(o.length<=0)return;let f=o.length===1,T=o[0],p=o[o.length-1];i===G?(e.style.removeProperty("width"),e.style.removeProperty("right"),e.style.removeProperty("left"),f?e.style.height=`${T}%`:e.style.height=`${Math.abs(T-p)}%`,u?(e.style.bottom="0%",f?e.style.top="auto":e.style.top=`${Math.min(100-p,100-T)}%`):(e.style.bottom="auto",f?e.style.top="0%":e.style.top=`${Math.min(T,p)}%`)):(e.style.removeProperty("height"),e.style.removeProperty("top"),e.style.removeProperty("bottom"),f?e.style.width=`${T}%`:e.style.width=`${Math.abs(T-p)}%`,s?(e.style.right="0%",f?e.style.left="auto":e.style.left=`${Math.min(100-p,100-T)}%`):(e.style.right="auto",f?e.style.left="0%":e.style.left=`${Math.min(T,p)}%`))}}),bt="--animate-onclick",yr="--width",wr="--height",Mr="--panel-bg-border-radius",Tr="--panel-bg",Or="--panel-bg-hover",xr="--panel-bg-fill",Dr="--pointer-width",Er="--pointer-height",Rr="--pointer-border-radius",kr="--pointer-bg",Cr="--pointer-bg-hover",Ar="--pointer-bg-focus",Br="--pointer-shadow",Pr="--pointer-shadow-hover",Fr="--pointer-shadow-focus",$r="--pointer-border",_r="--pointer-border-hover",Hr="--pointer-border-focus",ye=(e,i,o)=>{let s=new Map;for(let u of e.attributes){let f=u.nodeName.trim().toLowerCase();if(!i.test(f))continue;let T=f.replace(/\D/g,"").trim(),p=T===""||T==="0"||T==="1"?0:H(T,0)-1,h=o&&typeof o=="function"?o(u.value):u.value;s.set(p,h)}return s},Ir=e=>{if(!e)return null;let i=e.getAttribute(ur);if(!i)return null;let o=i.split(";"),s=[];for(let u of o)u.trim()!==""&&s.push(u.trim());return s},St=[[yr,Jt,"sliderWidth",null],[wr,Yt,"sliderHeight",null],[Mr,Gt,"sliderRadius",null],[Tr,Kt,"sliderBg",null],[Or,Xt,"sliderBgHover",null],[xr,Qt,"sliderBgFill",null],[Dr,Zt,"pointer#Width",/^pointer([0-9]*)-width$/],[Er,er,"pointer#Height",/^pointer([0-9]*)-height$/],[Rr,tr,"pointer#Radius",/^pointer([0-9]*)-radius$/],[kr,rr,"pointer#Bg",/^pointer([0-9]*)-bg$/],[Cr,ir,"pointer#BgHover",/^pointer([0-9]*)-bg-hover$/],[Ar,nr,"pointer#BgFocus",/^pointer([0-9]*)-bg-focus$/],[Br,sr,"pointer#Shadow",/^pointer([0-9]*)-shadow$/],[Pr,or,"pointer#ShadowHover",/^pointer([0-9]*)-shadow-hover$/],[Fr,lr,"pointer#ShadowFocus",/^pointer([0-9]*)-shadow-focus$/],[$r,ar,"pointer#Border",/^pointer([0-9]*)-border$/],[_r,dr,"pointer#BorderHover",/^pointer([0-9]*)-border-hover$/],[Hr,cr,"pointer#BorderFocus",/^pointer([0-9]*)-border-focus$/]],Ur=(e,i,o)=>{let s=null,u=[],f=new Map,T=(b,D=i)=>{let S=[...D.classList];for(let B of S)B.startsWith(b)&&i.classList.remove(B)},p=()=>{T("shape");let b=i.querySelectorAll(".pointer");for(let D of b)T("shape",D)},h=b=>{s=b,T("theme-"),typeof b=="string"&&i.classList.add(`theme-${b}`)},x=()=>{if(p(),!(u.length<=0)){i.classList.add("shape",`shape-${u[0]}`);for(let b=1;b<u.length;b++){let D=u[b];if(!D)continue;let S=i.querySelector(`.pointer-${b}`);!S||S.classList.add("shape",`shape-${D}`)}}},E=(b,D)=>{u[b]=D,x()},v=()=>{p();let b=ye(e,/^pointer([0-9]*)-shape$/);if(!(b.size<=0)){for(let D of b){let S=D[0];u[S]=D[1]}x()}},C=(b,D)=>`${b}-${D}`,Y=(b,D,S)=>{let B=o[S];if(!B)return;let W=S===0?i:B.$pointer;if(D==null){f.has(C(b,S))&&f.delete(C(b,S)),W.style.removeProperty(b);return}f.set(C(b,S),D),W.style.setProperty(b,D)},z=(b,D)=>f.get(C(b,D));return(()=>{for(let b of St){let[D,S,B,W]=b;if(W){let P=ye(e,W);for(let F of P){let j=F[0],q=F[1];Y(D,q,j)}}else{let P=e.getAttribute(S);Y(D,P,0)}let I=[];if(B.indexOf("#")===-1)I.push([B,0]);else{I.push([B.replace("#",""),0]),I.push([B.replace("#","0"),0]),I.push([B.replace("#","1"),0]);for(let P=1;P<o.length;P++)I.push([B.replace("#",(P+1).toString()),P])}for(let P of I)try{let F=P[0],j=P[1];Object.prototype.hasOwnProperty.call(e,F)||Object.defineProperty(e,F,{get(){return z(D,j)},set:q=>{Y(D,q,j)}})}catch(F){console.error(F)}}h(e.getAttribute(oe)),v()})(),{setStyle:Y,getStyle:z,get theme(){return s},set theme(b){h(b)},get pointerShapes(){return u},setPointerShape:E}},ue="animate-on-click",Lt="range-dragging",Wr=(e,i,o,s)=>{let u=[],f=E=>{for(let v of u)v.update&&typeof v.update=="function"&&v.update(E)},T=()=>{for(let E of u)E.destroy&&typeof E.destroy=="function"&&E.destroy()},p=(E,v)=>{for(let C of u)C.onAttrChange&&typeof C.onAttrChange=="function"&&C.onAttrChange(E,v)},h=E=>{if(E.gettersAndSetters){for(let v of E.gettersAndSetters)if(!(!v.name||!v.attributes))try{Object.prototype.hasOwnProperty.call(e,v.name)||Object.defineProperty(e,v.name,v.attributes)}catch(C){console.error("defineSettersGetters error:",C)}}},x=E=>{var v;if(!E.css)return;let C=(v=e.shadowRoot)==null?void 0:v.querySelector("style");!C||(C.innerHTML+=E.css)};return{init:()=>{if(window.tcRangeSliderPlugins)for(let E of window.tcRangeSliderPlugins){let v=E();u.push(v),v.init&&typeof v.init=="function"&&(v.init(e,i,o,s),h(v),x(v))}},update:f,onAttrChange:p,destroy:T}},Vr=10,yt=20,zr=(e,i)=>{let o=new Map,s=/^value([0-9]*)$/;for(let p of e.attributes){let h=p.nodeName.trim().toLowerCase();if(!s.test(h))continue;let x=h.replace("value","").trim(),E=x===""||x==="0"||x==="1"?0:H(x,0)-1,v=ee(p.value)?H(p.value,0):p.value;o.set(E,v)}let u=Math.max(...Array.from(o.keys())),f=[];f.push([We(e,i,0),o.get(0)]);let T=i;for(let p=1;p<=u;p++){let h=i.cloneNode(!0);T.after(h),T=h,f.push([We(e,h,p),o.get(p)])}return f},wt=(e,i,o,s,u,f,T)=>{try{Object.defineProperty(e,s,{configurable:!0,get(){if(!i)return;let p=i.pointers[o];if(!p)return;let h=i.getTextValue(p.percent);return ee(h)?H(h,h):h},set:p=>{i.pointers[o]?i?.setValue(p,o):i?.addPointer(p)}}),Object.defineProperty(e,u,{configurable:!0,get(){var p,h;return(h=(p=i?.pointers[o])==null?void 0:p.getAttr("aria-label"))!=null?h:void 0},set:p=>{!i||i.setAriaLabel(o,p)}}),Object.defineProperty(e,f,{configurable:!0,get(){var p,h;return(h=(p=i?.styles)==null?void 0:p.pointerShapes[o])!=null?h:null},set:p=>{!i||!i.styles||i.styles.setPointerShape(o,p)}}),Object.defineProperty(e,T,{configurable:!0,get(){var p;return(p=i?.pointers[o].disabled)!=null?p:!1},set:p=>{if(!i)return;let h=i?.pointers[o];!h||(h.disabled=p)}})}catch(p){console.error(p)}},Nr=(e,i)=>{let o=[["value","ariaLabel","pointerShape","pointerDisabled",0],["value0","ariaLabel0","pointerShape0","pointer0Disabled",0],["value1","ariaLabel1","pointerShape1","pointer1Disabled",0]];for(let s=2;s<Vr;s++)o.push([`value${s}`,`ariaLabel${s}`,`pointer${s}Shape`,`pointer${s}Disabled`,s-1]);for(let s of o)wt(e,i,s[4],s[0],s[1],s[2],s[3])},Mt=(e,i,o)=>{var s;let u=(s=o.shadowRoot)==null?void 0:s.querySelector(".container");if(u)for(let f of e)i?u.prepend(f.$pointer):u.append(f.$pointer)},jr=(e,i)=>{if(!(!i||e.length<=1)){for(let o of e)o.$pointer.style.zIndex=yt.toString();i.$pointer.style.zIndex=(yt*2).toString()}},Ve=0,ge=100,pe=2,Tt="0.3s",qr=(e,i,o)=>{let s=o.map(r=>r[0]),u=null,f=null,T=null,p=null,h=Ve,x=ge,E,v,C=ce,Y=pe,z=!1,b=!1,D=!1,S=0,B=1/0,W=!1,I,P,F=!1,j=!1,q=!1,re=Tt,Ot=[],xt=r=>{F||(r.preventDefault&&r.preventDefault(),ne(r),window.addEventListener("mousemove",ne),window.addEventListener("mouseup",we),gr(e,r))},we=r=>{F||(I=void 0,P=void 0,window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",we),re&&i.classList.add(ue),mr(e,r))},Gr=(r,a)=>{if(s.length<=0)return;if(s.length===1)return s[0].isClicked(r)&&re&&i.classList.remove(ue),s[0];let m=Xr(r);if(W){let k=a,K=Te(k);K!==void 0&&(k=ft(k,K)),m?(I=k,P=0,re&&i.classList.remove(ue)):I!==void 0&&(P=k-I,I=k)}if(!Kr(r)&&!m){for(let k of s)if(!(!k.isClicked(r)||k.disabled))return re&&i.classList.remove(ue),k;for(let k of s)if(u===k)return k}let A=1/0,$=null;for(let k of s){if(k.disabled)continue;let K=Math.abs(a-k.percent);K<A&&(A=K,$=k)}return $},Dt=()=>s.findIndex(r=>u===r&&!r.disabled),ne=r=>{let a;if(C===G){let{height:A,top:$}=i.getBoundingClientRect(),k=r.type.indexOf("mouse")!==-1?r.clientY:r.touches[0].clientY;a=Math.min(Math.max(0,k-$),A)*100/A}else{let{width:A,left:$}=i.getBoundingClientRect(),k=r.type.indexOf("mouse")!==-1?r.clientX:r.touches[0].clientX;a=Math.min(Math.max(0,k-$),A)*100/A}if((z||b)&&(a=100-a),u=Gr(r.target,a),u&&jr(s,u),W&&s.length>1&&P!==void 0){let A=s[0],$=s[s.length-1],k=A.percent+P<0,K=$.percent+P>100;if(k||K)return;for(let Ae=0;Ae<s.length;Ae++)J(Ae,s[Ae].percent+P);return}let m=Dt();m!==-1&&(J(m,a),u?.$pointer.focus())},Me=r=>{if(F||document.activeElement!==e||u?.disabled)return;r.stopPropagation(),r.preventDefault();let a=r.deltaY<0,m=z||b,A=a?!m:m,$=Dt();$!==-1&&(A?me($,s[$].percent):ve($,s[$].percent))},Et=r=>{F||j||(C===G?b?J(r,100):J(r,0):z?ve(r,s[r].percent):me(r,s[r].percent))},Rt=r=>{F||j||(C===G?b?J(r,0):J(r,100):z?me(r,s[r].percent):ve(r,s[r].percent))},kt=r=>{F||j||(C===G?b?ve(r,s[r].percent):me(r,s[r].percent):z?J(r,100):J(r,0))},Ct=r=>{F||j||(C===G?b?me(r,s[r].percent):ve(r,s[r].percent):z?J(r,0):J(r,100))},Kr=r=>r.classList.contains("panel"),Xr=r=>r.classList.contains("panel-fill"),me=(r,a)=>{if(a===void 0)return;let m=Te(a);m==null&&(m=1),a-=m,a<0&&(a=0),J(r,a)},ve=(r,a)=>{if(a===void 0)return;let m=Te(a);m==null&&(m=1),a+=m,a>100&&(a=100),J(r,a)},se=()=>{!p||p.update({percents:At(),values:Bt(),$pointers:Pt(),min:Ft(),max:$t(),data:je(),step:Ne(),round:Je(),type:qe(),textMin:Oe(),textMax:xe(),rightToLeft:Ke(),bottomToTop:Xe(),pointersOverlap:tt(),pointersMinDistance:Ye(),pointersMaxDistance:Ge(),rangeDragging:rt(),disabled:Qe(),keyboardDisabled:Ze(),mousewheelDisabled:et()})},Qr=()=>{se()},Zr=r=>{if(!(D||s.length<=1||x===h))if(r===0){let a=B*100/(x-h);return Math.max(0,s[r+1].percent-a)}else{let a=S*100/(x-h);return Math.min(s[r-1].percent+a,100)}},ei=r=>{if(!(D||s.length<=1||x===h))if(r===s.length-1){let a=B*100/(x-h);return Math.min(s[r-1].percent+a,100)}else{let a=S*100/(x-h);return Math.max(0,s[r+1].percent-a)}},Te=r=>{let a;if(typeof E=="function"){let m=Ue(0,100,h,x,r);a=E(m,r)}else a=E;if(ee(a)){let m=x-h;return a=m===0?0:a*100/m,a}},he=r=>{if(r===void 0)return;let a=Ue(0,100,h,x,r);return v!==void 0?v[Math.round(a)]:pr(a,Y)},Oe=()=>v!==void 0?v[h]:h,xe=()=>v!==void 0?v[x]:x,Ne=()=>E,ti=r=>{var a;return r<=0||D?Oe():(a=he(s[r-1].percent))!=null?a:""},ri=r=>{var a;return s.length<=1||r>=s.length-1||D?xe():(a=he(s[r+1].percent))!=null?a:""},At=()=>s.map(r=>r.percent),Bt=()=>s.map(r=>he(r.percent)),Pt=()=>s.map(r=>r.$pointer),Ft=()=>h,$t=()=>x,je=()=>v,qe=()=>C,Je=()=>Y,Ye=()=>S,Ge=()=>B,ii=r=>Ot[r],Ke=()=>z,Xe=()=>b,Qe=()=>F,Ze=()=>j,et=()=>q,tt=()=>D,rt=()=>W,J=(r,a)=>{if(a===void 0)return;let m=Te(a);m!==void 0&&(a=ft(a,m));let A=s[r];if(!A)return;let $=A.updatePosition(a,Zr(r),ei(r),C,z,b);f?.updatePosition(C,s.map(k=>k.percent),z,b),se();for(let k of s){let K=he(k.percent);K!==void 0&&(k.setAttr("aria-valuenow",K.toString()),k.setAttr("aria-valuetext",K.toString()))}si(),$&&fr(e,s.map(k=>he(k.percent)))},Z=()=>{for(let r=0;r<s.length;r++)J(r,s[r].percent)},ni=(r,a)=>{h=v!==void 0?0:H(r,Ve),x=v!==void 0?v.length-1:H(a,ge),De(h),Ee(x)},si=()=>{var r,a;for(let m=0;m<s.length;m++){let A=s[m];A.setAttr("aria-valuemin",((r=ti(m))!=null?r:"").toString()),A.setAttr("aria-valuemax",((a=ri(m))!=null?a:"").toString())}},De=r=>{h=H(r,Ve),h>x&&(x=h+ge),Z()},Ee=r=>{x=H(r,ge),x<h&&(x=h+ge),Z()},_t=r=>{D=!0;for(let a=0;a<r.length;a++)Re(r[a],a);D=!1;for(let a=0;a<r.length;a++)Re(r[a],a)},Re=(r,a)=>{let m;v!==void 0?(m=r==null?0:Sr(r,v),m===-1&&(m=0)):(m=H(r,h),m<h&&(m=h),m>x&&(m=x));let A=Ue(h,x,0,100,m);J(a,A)},ke=r=>{if(r==null){E=void 0;return}if(typeof r=="function"){E=r,Z();return}if(ee(r)){E=H(r,1);let a=Math.abs(x-h);E>a&&(E=void 0),Z();return}E=void 0},it=r=>{D=r,Z()},nt=r=>{(!ee(r)||r<0)&&(r=0),S=r},st=r=>{(!ee(r)||r<0)&&(r=1/0),B=r},ot=r=>{F=r,i.classList.toggle("disabled",F),F?i.setAttribute("aria-disabled","true"):i.hasAttribute("aria-disabled")&&i.removeAttribute("aria-disabled")},Ht=r=>{j=r},It=r=>{q=r,q?document.removeEventListener("wheel",Me):document.addEventListener("wheel",Me,{passive:!1})},lt=r=>{if(r==null){v=void 0;return}if(v=br(r),v===void 0||v.length<=0){v=void 0;return}De(0),Ee(v.length-1),E===void 0&&ke(1)},at=r=>{var a;typeof r=="string"?C=r.trim().toLowerCase()===G?G:ce:C=ce;let m=(a=e.shadowRoot)==null?void 0:a.querySelector(".range-slider-box");if(!m)return;m.className=`range-slider-box type-${C}`,Z();let A=C===G?"vertical":"horizontal";for(let $ of s)$.setAttr("aria-orientation",A)},dt=r=>{z=r,s.length>1&&Mt(s,z,e),Z(),se()},ct=r=>{b=r,s.length>1&&Mt(s,b,e),Z(),se()},ut=r=>{Y=H(r,pe),Y<0&&(Y=pe),se()},Ut=r=>{r==null||r.toString().trim().toLowerCase()==="false"?(re=void 0,i.style.removeProperty(bt),i.classList.remove(ue)):(re=r.toString(),i.style.setProperty(bt,re),i.classList.add(ue))},Wt=(r,a)=>{let m=s[r];!m||(m.setAttr("aria-label",a),Ot[r]=a)},Ce=r=>{if(I=void 0,s.length<=1){W=!1,i.classList.remove(Lt);return}W=r,i.classList.toggle(Lt,W)},oi=()=>{ot(V(e.getAttribute(de))),j=V(e.getAttribute(gt)),q=V(e.getAttribute(mt));let r=ye(e,/^pointer([0-9]*)-disabled$/,a=>V(a));for(let a of r){let m=a[0];!s[m]||(s[m].disabled=a[1])}},li=()=>{let r=ye(e,/^aria-label([0-9]*)$/);for(let a of r){let m=a[0];Wt(m,a[1])}},ai=r=>{let a=s.length,m=s[a-1].$pointer,A=m.cloneNode(!0);m.after(A);let $=We(e,A,a);return $.setCallbacks(Et,Rt,kt,Ct),s.push($),Re(r,a),Z(),se(),a},di=()=>{let r=s.length,a=s[r-1];return a?(a.destroy(),s.pop(),s.length<=1&&Ce(!1),Z(),se(),r-1):-1};return(()=>{var r,a;for(let A of s)A.setCallbacks(Et,Rt,kt,Ct);let m=(r=e.shadowRoot)==null?void 0:r.querySelector(".panel-fill");m&&(f=Lr(m)),at(e.getAttribute(Q)),dt(V(e.getAttribute(le))),ct(V(e.getAttribute(ae))),ni(e.getAttribute(O),e.getAttribute(_)),ke(e.getAttribute(U)),lt(e.getAttribute(M)),_t(o.map(A=>A[1])),it(V(e.getAttribute(L))),nt(H(e.getAttribute(y),0)),st(H(e.getAttribute(R),1/0)),Ce(V(e.getAttribute(w))),ut(H(e.getAttribute(N),pe)),oi(),li(),T=Ur(e,i,s),Ut((a=e.getAttribute(vt))!=null?a:Tt),i.addEventListener("mousedown",xt),i.addEventListener("mouseup",we),i.addEventListener("touchmove",ne),i.addEventListener("touchstart",ne),q||document.addEventListener("wheel",Me,{passive:!1}),p=Wr(e,Qr,{setValues:_t,setMin:De,setMax:Ee,setStep:ke,setPointersOverlap:it,setPointersMinDistance:nt,setPointersMaxDistance:st,setDisabled:ot,setType:at,setRightToLeft:dt,setBottomToTop:ct,setRound:ut,setKeyboardDisabled:Ht,setMousewheelDisabled:It,setRangeDragging:Ce,setData:lt},{getPercents:At,getValues:Bt,getPointerElements:Pt,getMin:Ft,getMax:$t,getStep:Ne,getData:je,getType:qe,getRound:Je,getTextMin:Oe,getTextMax:xe,isRightToLeft:Ke,isBottomToTop:Xe,isDisabled:Qe,isKeyboardDisabled:Ze,isMousewheelDisabled:et,isPointersOverlap:tt,isRangeDraggingEnabled:rt,getPointersMinDistance:Ye,getPointersMaxDistance:Ge}),p.init()})(),{get pointers(){return s},get styles(){return T},get pluginsManager(){return p},get min(){return Oe()},get max(){return xe()},get step(){return Ne()},get pointersOverlap(){return tt()},set pointersOverlap(r){it(r)},get pointersMinDistance(){return Ye()},set pointersMinDistance(r){nt(r)},get pointersMaxDistance(){return Ge()},set pointersMaxDistance(r){st(r)},get disabled(){return Qe()},set disabled(r){ot(r)},get data(){return je()},get type(){return qe()},set type(r){at(r)},get rightToLeft(){return Ke()},set rightToLeft(r){dt(r)},get bottomToTop(){return Xe()},set bottomToTop(r){ct(r)},get round(){return Je()},set round(r){ut(r)},get animateOnClick(){return re},set animateOnClick(r){Ut(r)},get keyboardDisabled(){return Ze()},set keyboardDisabled(r){Ht(r)},get mousewheelDisabled(){return et()},set mousewheelDisabled(r){It(r)},get rangeDragging(){return rt()},set rangeDragging(r){Ce(r)},setMin:De,setMax:Ee,setValue:Re,setStep:ke,setData:lt,getTextValue:he,setAriaLabel:Wt,getAriaLabel:ii,addPointer:ai,removePointer:di,destroy:()=>{i.removeEventListener("mousedown",xt),i.removeEventListener("mouseup",we),i.removeEventListener("touchmove",ne),i.removeEventListener("touchstart",ne),document.removeEventListener("wheel",Me);for(let r of s)r.destroy();p?.destroy()}}},Jr=(e,i,o)=>{let s=St.find(([p,h,x,E])=>h.replace("#","")===i.replace(/\d+/g,""));if(s&&e.styles){let[p,h,x,E]=s,v=i.replace(/\D/g,"").trim(),C=v===""||v==="0"||v==="1"?0:H(v,0)-1;e.styles.setStyle(p,o,C);return}switch(e&&e.pluginsManager&&e.pluginsManager.onAttrChange(i,o),i){case O:{e.setMin(o);break}case _:{e.setMax(o);break}case U:{e.setStep(o);break}case L:{e.pointersOverlap=V(o);break}case y:{e.pointersMinDistance=H(o,0);break}case w:{e.rangeDragging=V(o);break}case R:{e.pointersMaxDistance=H(o,1/0);break}case de:{e.disabled=V(o);break}case gt:{e.keyboardDisabled=V(o);break}case mt:{e.mousewheelDisabled=V(o);break}case M:{e.setData(o);break}case Q:{e.type=o;break}case le:{e.rightToLeft=V(o);break}case ae:{e.bottomToTop=V(o);break}case N:{e.round=H(o,pe);break}case oe:{e.styles&&(e.styles.theme=o);break}case vt:{e.animateOnClick=o;break}}let u=null;if(/^value([0-9]*)$/.test(i)&&(u="value"),/^pointer([0-9]*)-disabled$/.test(i)&&(u="pointer-disabled"),/^aria-label([0-9]*)$/.test(i)&&(u="aria-label"),/^pointer([0-9]*)-shape$/.test(i)&&(u="pointer-shape"),!u)return;let f=i.replace(/\D/g,"").trim(),T=f===""||f==="0"||f==="1"?0:H(f,0)-1;switch(u){case"value":{e.setValue(o,T);break}case"pointer-disabled":{let p=e?.pointers[T];if(!p)return;p.disabled=V(o);break}case"aria-label":{e.setAriaLabel(T,o);break}case"pointer-shape":{e.styles&&e.styles.setPointerShape(T,o);break}}},Yr=class extends HTMLElement{constructor(){super(),d(this,"slider"),d(this,"_externalCSSList",[]),d(this,"_observer",null),this.attachShadow({mode:"open"})}set step(e){this.slider&&this.slider.setStep(e)}get step(){var e;return(e=this.slider)==null?void 0:e.step}set disabled(e){this.slider&&(this.slider.disabled=e)}get disabled(){var e,i;return(i=(e=this.slider)==null?void 0:e.disabled)!=null?i:!1}set data(e){var i;(i=this.slider)==null||i.setData(e)}get data(){var e;return(e=this.slider)==null?void 0:e.data}set min(e){var i;(i=this.slider)==null||i.setMin(e)}get min(){var e;return(e=this.slider)==null?void 0:e.min}set max(e){var i;(i=this.slider)==null||i.setMax(e)}get max(){var e;return(e=this.slider)==null?void 0:e.max}set round(e){!this.slider||(this.slider.round=e)}get round(){var e,i;return(i=(e=this.slider)==null?void 0:e.round)!=null?i:pe}set type(e){!this.slider||(this.slider.type=e??ce)}get type(){var e;return((e=this.slider)==null?void 0:e.type)||ce}set pointersOverlap(e){!this.slider||(this.slider.pointersOverlap=e)}get pointersOverlap(){var e,i;return(i=(e=this.slider)==null?void 0:e.pointersOverlap)!=null?i:!1}set pointersMinDistance(e){!this.slider||(this.slider.pointersMinDistance=e)}get pointersMinDistance(){var e,i;return(i=(e=this.slider)==null?void 0:e.pointersMinDistance)!=null?i:0}set pointersMaxDistance(e){!this.slider||(this.slider.pointersMaxDistance=e)}get pointersMaxDistance(){var e,i;return(i=(e=this.slider)==null?void 0:e.pointersMaxDistance)!=null?i:1/0}set theme(e){!this.slider||!this.slider.styles||(this.slider.styles.theme=e)}get theme(){var e,i,o;return(o=(i=(e=this.slider)==null?void 0:e.styles)==null?void 0:i.theme)!=null?o:null}set rtl(e){!this.slider||(this.slider.rightToLeft=e)}get rtl(){var e,i;return(i=(e=this.slider)==null?void 0:e.rightToLeft)!=null?i:!1}set btt(e){!this.slider||(this.slider.bottomToTop=e)}get btt(){var e,i;return(i=(e=this.slider)==null?void 0:e.bottomToTop)!=null?i:!1}set keyboardDisabled(e){!this.slider||(this.slider.keyboardDisabled=e)}get keyboardDisabled(){var e,i;return(i=(e=this.slider)==null?void 0:e.keyboardDisabled)!=null?i:!1}set mousewheelDisabled(e){!this.slider||(this.slider.mousewheelDisabled=e)}get mousewheelDisabled(){var e,i;return(i=(e=this.slider)==null?void 0:e.mousewheelDisabled)!=null?i:!1}set animateOnClick(e){!this.slider||(this.slider.animateOnClick=e)}get animateOnClick(){var e;return(e=this.slider)==null?void 0:e.animateOnClick}get rangeDragging(){var e,i;return(i=(e=this.slider)==null?void 0:e.rangeDragging)!=null?i:!1}set rangeDragging(e){this.slider&&(this.slider.rangeDragging=V(e))}get externalCSSList(){return this._externalCSSList}addPointer(e){var i,o;if(!this.slider)return;let s=(o=(i=this.slider)==null?void 0:i.addPointer(e))!=null?o:0;wt(this,this.slider,s,`value${s+1}`,`ariaLabel${s+1}`,`pointerShape${s+1}`,`pointer${s+1}Disabled`)}removePointer(){var e;!this.slider||(e=this.slider)==null||e.removePointer()}addCSS(e){if(!this.shadowRoot)return;let i=document.createElement("style");i.textContent=e,this.shadowRoot.appendChild(i)}connectedCallback(){var e,i;if(!this.shadowRoot)return;this._externalCSSList=Ir(this),this.shadowRoot.innerHTML=l(g,this._externalCSSList);let o=(e=this.shadowRoot)==null?void 0:e.querySelector(".pointer");if(!o)return;let s=(i=this.shadowRoot)==null?void 0:i.getElementById("range-slider");if(!s)return;let u=zr(this,o);this.slider=qr(this,s,u),Nr(this,this.slider),this._observer=new MutationObserver(f=>{f.forEach(T=>{var p;if(!this.slider||T.type!=="attributes")return;let h=T.attributeName;!h||Jr(this.slider,h,(p=this.getAttribute(h))!=null?p:"")})}),this._observer.observe(this,{attributes:!0})}disconnectedCallback(){this._observer&&this._observer.disconnect(),this.slider&&this.slider.destroy()}},ze=Yr;window.tcRangeSlider=ze,customElements.get("toolcool-range-slider")||customElements.define("toolcool-range-slider",ze),customElements.get("tc-range-slider")||customElements.define("tc-range-slider",class extends ze{})})();var Ie=class extends HTMLElement{get range_min(){return Number(this.slider.value1)}set range_min(t){this.slider.value1=t}get range_max(){return Number(this.slider.value2)}set range_max(t){this.slider.value2=t}slider;label_range_min;label_range_max;constructor(){super(),this.attachShadow({mode:"open"});let t=document.createElement("div"),n=document.createElement("span");n.textContent="\u79FB\u52D5\u7BC4\u56F2: ",t.appendChild(n);let d=document.createElement("span");d.textContent="0",t.appendChild(d),this.label_range_min=d;let l=document.createElement("tc-range-slider");l.style.padding="0 1em",l.style.display="inline-block",t.appendChild(l),this.slider=l;let g=document.createElement("span");d.textContent="100",t.appendChild(g),this.label_range_max=g,this.shadowRoot?.append(t),this.slider.addEventListener("change",L=>{this.label_range_min.textContent=String(this.slider.value1),this.label_range_max.textContent=String(this.slider.value2)}),this.slider.addEventListener("mouseup",L=>{console.log(`min: ${this.range_min}, max: ${this.range_max}`)})}InitializeSlider(){this.slider.min=0,this.slider.max=100,this.slider.step=1,this.slider.value1=0,this.slider.value2=100,this.slider.sliderWidth="200px",this.slider.style.padding="0 1em"}};customElements.define("slider-container",Ie);var Mi;async function Ti(){console.log("main loaded."),Mi=new He}window.onload=Ti;
