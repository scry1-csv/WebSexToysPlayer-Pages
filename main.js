var wi=Object.create;var zt=Object.defineProperty;var Mi=Object.getOwnPropertyDescriptor;var Ti=Object.getOwnPropertyNames;var Oi=Object.getPrototypeOf,xi=Object.prototype.hasOwnProperty;var Nt=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var Di=(u,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ti(e))!xi.call(u,o)&&o!==n&&zt(u,o,{get:()=>e[o],enumerable:!(s=Mi(e,o))||s.enumerable});return u};var Ei=(u,e,n)=>(n=u!=null?wi(Oi(u)):{},Di(e||!u||!u.__esModule?zt(n,"default",{value:u,enumerable:!0}):n,u));var ir=Nt(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.roundAction=K.getSpeed=K.getActionGroups=void 0;var Fi=function(u){var e=[],n=-1,s=-1;return u.forEach(function(o,c){if(c===0){e.push([o]),n++;return}if(c===1){e[n].push(o),s=Math.max(250,o.at-u[c-1].at);return}var L=o.at-u[c-1].at;L>5*s?(e.push([o]),n++):e[n].push(o),s=Math.max(250,L)}),e};K.getActionGroups=Fi;var Bi=function(u,e){if(!u||!e||u.at===e.at)return 0;try{if(e.at<u.at){var n=e;e=u,u=n}return 1e3*(Math.abs(e.pos-u.pos)/Math.abs(e.at-u.at))}catch(s){return console.error("Failed on actions",u,e,s),0}};K.getSpeed=Bi;var Pi=function(u){var e={at:Math.max(0,Math.round(u.at)),pos:Math.max(0,Math.min(100,Math.round(u.pos)))};return u.subActions&&(e.subActions=u.subActions.map(function(n){return K.roundAction(n)})),u.type&&(e.type=u.type),e};K.roundAction=Pi});var nr=Nt(q=>{"use strict";var de=q&&q.__assign||function(){return de=Object.assign||function(u){for(var e,n=1,s=arguments.length;n<s;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(u[o]=e[o])}return u},de.apply(this,arguments)};Object.defineProperty(q,"__esModule",{value:!0});q.convertFunscriptToCsv=q.addFunscriptMetadata=q.getFunscriptFromString=void 0;var st=ir(),$i=function(u){var e=JSON.parse(u);return q.addFunscriptMetadata(e)};q.getFunscriptFromString=$i;var _i=function(u){var e=de({},u);e.actions=e.actions.sort(function(o,c){return o.at-c.at}).map(st.roundAction);var n=e.actions.slice(-1)[0].at,s=e.actions.reduce(function(o,c,L){if(L===0)return o;var R=st.getSpeed(e.actions[L-1],e.actions[L]);return o+R},0)/(e.actions.length-1);return e.metadata=de(de({},e.metadata),{duration:n,average_speed:s}),e};q.addFunscriptMetadata=_i;var Ui=function(u){var e=JSON.parse(u),n=e.actions.map(function(o){var c=st.roundAction(o);return c.at+","+c.pos}).join(`
`),s=new Blob([n],{type:"text/plain"});return s};q.convertFunscriptToCsv=Ui});import*as Z from"buttplug";import{ButtplugWasmClientConnector as jt}from"buttplug-wasm";var Me=class{_client=new Z.ButtplugClient;_deviceRefleshedEvents=[];UFOTWReverseLR=!1;get isViberatorConnected(){return this.Devices.Viberators.length>0}get isRotatorConnected(){return this.Devices.Rotators.length>0}get isLinearsConnected(){return this.Devices.Linears.length>0}get isUFOTWConnected(){return this.Devices.UFOTW.length>0}Devices={Viberators:[],Rotators:[],Linears:[],UFOTW:[]};constructor(){console.log("buttplugOperator constructed."),this._client.addListener("deviceadded",async e=>{console.log(`device added: ${e.name}`),this.ParseDeviceList()}),this._client.addListener("deviceremoved",e=>{console.log(`device removed: ${e.name}`),this.ParseDeviceList()})}async connectWasm(){return jt.activateLogging(),this.connect(new jt)}async connectWebsocket(e){let n=new Z.ButtplugBrowserWebsocketClientConnector(e);return this.connect(n)}async connect(e){try{await this._client.connect(e)}catch(n){return console.log(`${n}`),n instanceof Z.ButtplugError&&(console.log("this is a buttplug error"),n instanceof Z.ButtplugClientConnectorException?console.log("This is a connector error"):console.log("Was another type of error")),!1}return!0}AddDevicesRefleshedEvents(e){this._deviceRefleshedEvents.push(e)}ParseDeviceList(){this.Devices.Viberators.splice(0),this.Devices.Rotators.splice(0),this.Devices.Linears.splice(0),this.Devices.UFOTW.splice(0);for(let e of this._client.devices){e.name==="Vorze UFO TW"?(this.Devices.UFOTW.push(e),e.rotate([[.3,!0],[.3,!1]]),setTimeout(()=>{e.stop()},600)):e.vibrateAttributes.length>0?(this.Devices.Viberators.push(e),e.vibrate(.5),setTimeout(()=>{e.stop()},600)):e.rotateAttributes.length>0?(this.Devices.Rotators.push(e),e.rotate(.5,!0),setTimeout(()=>{e.stop()},600)):e.linearAttributes.length>0&&(this.Devices.Linears.push(e),e.linear(0,1e3),setTimeout(()=>{e.linear(.5,1e3)},1e3),setTimeout(()=>{e.linear(0,1e3)},2e3)),console.log("Viberators:");for(let n of this.Devices.Viberators)console.log("  "+n.name);console.log("Rotators:");for(let n of this.Devices.Rotators)console.log("  "+n.name);console.log("Linears:");for(let n of this.Devices.Linears)console.log("  "+n.name)}for(let e of this._deviceRefleshedEvents)e()}StopAllDevices(){for(let e of this.Devices.Viberators)e.stop();for(let e of this.Devices.Rotators)e.stop();for(let e of this.Devices.Linears)e.stop();for(let e of this.Devices.UFOTW)e.stop()}SendViberateMsg(e){this.Devices.Viberators.forEach(n=>{n.vibrate(e)})}SendRotateMsg(e,n){this.Devices.Rotators.forEach(s=>{s.rotate(e,n)})}SendLinearMsg(e,n){this.Devices.Linears.forEach(s=>{s.linear(e,n)})}SendUFOTWMsg(e,n,s,o){this.Devices.UFOTW.forEach(c=>{this.UFOTWReverseLR?c.rotate([[s,o],[e,n]]):c.rotate([[e,n],[s,o]])})}async ConnectDevice(){this._client.connected?await this._client.startScanning():console.log("buttplug client is not connected.")}};var P=class{Milliseconds=0;Power=0;constructor(e,n){this.Milliseconds=e,n<0?this.Power=0:n>1e3?this.Power=1e3:this.Power=n}get ButtPower(){return this.Power/1e3}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),n=Math.floor(e/60),s=Math.floor(n/60),o=String(e%60).padStart(2,"0"),c=String(n%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${c}:${o}`}toString(){return`Time: ${this.Milliseconds}, Power: ${this.ButtPower}`}},qt=/^([0-9]+)(\.[0-9]{1,2})?,(1000|[0-9]+)$/;function Jt(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/);n.slice(-1)[0]===""&&n.pop();let s=!0;for(let o=0;o<n.length;o++)if(!n[o].match(qt)){s=!1;break}return s}function Yt(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of n){let c=o.match(qt);if(c){let L=Number(c[1])*1e3;if(c[2]){let J=c[2].replace(".",""),X;J.length==1?X=Number(J)*10:X=Number(J),L+=X*10}let R=Number(c[3]),H=new P(L,R);s.push(H)}}return console.log("script start time: "+s[0].HHMMSS),s}function rt(u){let e=[];for(let s of u){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var Ri=[new P(500,800),new P(600,0),new P(1500,400),new P(1600,0),new P(2500,800),new P(2600,0),new P(3500,400),new P(3600,0),new P(4500,800),new P(4600,0),new P(5500,400),new P(5600,0),new P(6500,800),new P(6600,0),new P(7500,400),new P(7600,0)],Ni=rt(Ri);var it=class{Milliseconds=0;Clockwise=!0;Power=0;get ButtPower(){return this.Power/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),n=Math.floor(e/60),s=Math.floor(n/60),o=String(e%60).padStart(2,"0"),c=String(n%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${c}:${o}`}constructor(e,n,s){this.Milliseconds=e,this.Clockwise=n,s<0?this.Power=0:s>100?this.Power=100:this.Power=s}toString(){return`Time: ${this.Milliseconds}, Clockwise: ${this.Clockwise} Power: ${this.ButtPower}`}},Gt=/^([0-9]+),(0|1),(100|[0-9]{1,2})$/;function Kt(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/);n.slice(-1)[0]===""&&n.pop();let s=!0;for(let o=0;o<n.length;o++)if(!n[o].match(Gt)){s=!1;break}return s}function Xt(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of n){let c=o.match(Gt);if(c){let L=Number(c[1])*100,R=c[2]==="1",H=Number(c[3]),J=new it(L,R,H);s.push(J)}}return console.log("script start time: "+s[0].HHMMSS),s}function Qt(u){let e=[];for(let s of u){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var nt=class{Milliseconds=0;LeftClockwise=!0;LeftPower=0;RightClockwise=!0;RightPower=0;get LeftButtPower(){return this.LeftPower/100}get RightButtPower(){return this.RightPower/100}get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get HHMMSS(){let e=Math.floor(this.Milliseconds/1e3),n=Math.floor(e/60),s=Math.floor(n/60),o=String(e%60).padStart(2,"0"),c=String(n%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${c}:${o}`}constructor(e,n,s,o,c){this.Milliseconds=e,this.LeftClockwise=n,this.RightClockwise=o,s<0?this.LeftPower=0:s>100?this.LeftPower=100:this.LeftPower=s,c<0?this.RightPower=0:c>100?this.RightPower=100:this.RightPower=c}toString(){return`Time: ${this.Milliseconds}, LeftClockwise: ${this.LeftClockwise} LeftPower: ${this.LeftButtPower}, LeftClockwise: ${this.RightClockwise} LeftPower: ${this.RightButtPower}`}},Zt=/^([0-9]+),(0|1),(100|[0-9]{1,2}),(0|1),(100|[0-9]{1,2})$/;function er(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/);n.slice(-1)[0]===""&&n.pop();let s=!0;for(let o=0;o<n.length;o++)if(!n[o].match(Zt)){s=!1;break}return s}function tr(u){let n=u.replace(/\r\n|\r/g,`
`).split(/\n/),s=[];for(let o of n){let c=o.match(Zt);if(c){let L=Number(c[1])*100,R=c[2]==="1",H=Number(c[3]),J=c[4]==="1",X=Number(c[5]),ce=new nt(L,R,H,J,X);s.push(ce)}}return console.log("script start time: "+s[0].HHMMSS),s}function rr(u){let e=[];for(let s of u){let o=s.Seconds;e[o]||(e[o]=[]),e[o].push(s)}return e}var ot=Ei(nr(),1),Te=class{Title;Origin;Ranged;Splitted;get OriginMin(){return this.getMin(this.Origin)}get OriginMax(){return this.getMax(this.Origin)}get RangedMin(){return this.getMin(this.Ranged)}get RangedMax(){return this.getMax(this.Ranged)}constructor(e,n){this.Title=e;let s=(0,ot.getFunscriptFromString)(n),o=this.ConvertJsonToScript(s);console.log("funscript loaded. lines: "+o.length),console.log("script start time: "+o[0].HHMMSS),this.Origin=o,this.Ranged=o,this.Splitted=this.SplitLines(o)}ConvertJsonToScript(e){let n=e.actions,s=[],o=0;for(let c of n){let L=c.at-o;s.push(new Oe(o,c.pos,L)),o=c.at}return s}SetRange(e,n){let s=[];for(let o of this.Origin){let c=this.normalize(o.Position,this.OriginMin,this.OriginMax,e,n),L=new Oe(o.Milliseconds,c,o.Duration);s.push(L)}this.Ranged=s,this.Splitted=this.SplitLines(s);for(let o=0;o<10;o++)console.log(this.Ranged[o]);console.log("newmin: "+this.getMin(this.Ranged)),console.log("newmax: "+this.getMax(this.Ranged)),console.log("splitted.length: "+this.Splitted.length)}Validate(e){try{let n=(0,ot.getFunscriptFromString)(e);return!0}catch{return console.log("Loading funscript is failed."),!1}}getMin(e){let n=e.map(o=>o.Position),s=(o,c)=>Math.min(o,c);return n.reduce(s)}getMax(e){let n=e.map(o=>o.Position),s=(o,c)=>Math.max(o,c);return n.reduce(s)}SplitLines(e){let n=[];for(let o of e){let c=o.Seconds;n[c]||(n[c]=[]),n[c].push(o)}return n}normalize(e,n,s,o,c){if(n>s)throw new RangeError("oldMin is greater than oldMax.");if(o>c)throw new RangeError("newMin is greater than newMax.");e>s&&(e=s),e<n&&(e=n);let L=s-n,R=c-o;return(e-n)*R/L+o}},Oe=class{Milliseconds=0;Position=0;Duration=0;get Seconds(){return Math.trunc(this.Milliseconds/1e3)}get ButtPosition(){return this.Position/100}get HHMMSS(){let e=this.Seconds,n=Math.floor(e/60),s=Math.floor(n/60),o=String(e%60).padStart(2,"0"),c=String(n%60).padStart(2,"0");return`${String(s).padStart(2,"0")}:${c}:${o}`}constructor(e,n,s){if(e<0)throw new RangeError("milliseconds does not accept negative values.");if(n<0||n>100)throw new RangeError("position does not accept values outside the range 0 to 100.");if(s<0)throw new RangeError("milliseconds does not accept negative values.");this.Milliseconds=e,this.Duration=s,this.Position=n}toString(){return`Time: ${this.Milliseconds}, Positon: ${this.Position}, Duration: ${this.Duration}`}};var xe=class{_buttplugOperator;_previousSeconds=0;_timerIDs=new Set;VorzeSAScriptToUFOTW=!1;Offset=0;Scripts={TimeRoter:void 0,Vorze_SA:void 0,Funscript:void 0,UFOTW:void 0};constructor(e){this._buttplugOperator=e}LoadScript(e,n){if(console.log("path: "+n),n.endsWith(".funscript"))return this.Scripts.Funscript=new Te(n,e),!0;if(Jt(e)){let s=Yt(e);return this.Scripts.TimeRoter={Script:s,Splitted:rt(s),Title:n},console.log("timeroter script loaded. lines: "+s.length),!0}else if(er(e)){let s=tr(e);return this.Scripts.UFOTW={Script:s,Splitted:rr(s),Title:n},console.log("UFOTW script loaded. lines: "+s.length),!0}else if(Kt(e)){let s=Xt(e);return this.Scripts.Vorze_SA={Script:s,Splitted:Qt(s),Title:n},console.log("Vorze_SA script loaded. lines: "+s.length),!0}else return!1}Stop(){this._previousSeconds=0,this._buttplugOperator.StopAllDevices(),this._timerIDs.forEach(e=>{clearTimeout(e)}),this._timerIDs.clear()}TimeUpdate(e){let n=e+this.Offset,s=Math.trunc(n);s!==this._previousSeconds&&(this.OperateTimeRoterScript(n),this.OperateVorzeSAScript(n),this.OperateFunscript(n),this.OperateUFOTWScript(n),this._previousSeconds=s)}SetFunscriptRange(e,n){this.Scripts.Funscript?.SetRange(e,n)}OperateTimeRoterScript(e){if(!this.Scripts.TimeRoter)return;let n=Math.trunc(e),s=this.Scripts.TimeRoter.Splitted;this._buttplugOperator.isViberatorConnected&&n!==this._previousSeconds&&s[n+1]&&s[n+1].forEach(o=>{let c=o.Milliseconds-Math.trunc(e*1e3),L=`send ViberateMsg: ${o.toString()}`;setTimeout(()=>console.log(L),c);let R=window.setTimeout(()=>{this._buttplugOperator.SendViberateMsg(o.ButtPower)},c);this._timerIDs.add(R),setTimeout(()=>{this._timerIDs.delete(R)},3e3)})}OperateVorzeSAScript(e){if(!this.Scripts.Vorze_SA)return;let n=Math.trunc(e),s=this.Scripts.Vorze_SA.Splitted;(this._buttplugOperator.isRotatorConnected||this.VorzeSAScriptToUFOTW&&this._buttplugOperator.isUFOTWConnected)&&n!==this._previousSeconds&&s[n+1]&&s[n+1].forEach(c=>{let L=c.Milliseconds-Math.trunc(e*1e3),R=`send RotateMsg: ${c.toString()}`;setTimeout(()=>console.log(R),L);let H=window.setTimeout(()=>{this._buttplugOperator.SendRotateMsg(c.ButtPower,c.Clockwise),this.VorzeSAScriptToUFOTW&&this._buttplugOperator.SendUFOTWMsg(c.ButtPower,c.Clockwise,c.ButtPower,c.Clockwise)},L);this._timerIDs.add(H),setTimeout(()=>{this._timerIDs.delete(H)},3e3)})}OperateUFOTWScript(e){if(!this.Scripts.UFOTW)return;let n=Math.trunc(e),s=this.Scripts.UFOTW.Splitted;this._buttplugOperator.isUFOTWConnected&&n!==this._previousSeconds&&s[n+1]&&s[n+1].forEach(o=>{let c=o.Milliseconds-Math.trunc(e*1e3),L=`send RotateMsg: ${o.toString()}`;setTimeout(()=>console.log(L),c);let R=window.setTimeout(()=>{this._buttplugOperator.SendUFOTWMsg(o.LeftButtPower,o.LeftClockwise,o.RightButtPower,o.RightClockwise)},c);this._timerIDs.add(R),setTimeout(()=>{this._timerIDs.delete(R)},3e3)})}OperateFunscript(e){if(!this.Scripts.Funscript)return;let n=Math.trunc(e),s=e*1e3,o=this.Scripts.Funscript.Splitted;this._buttplugOperator.isLinearsConnected&&n!==this._previousSeconds&&o[n+1]&&o[n+1].forEach(c=>{let L=c.Milliseconds-s,R=`send LinearMsg: ${c.toString()}`;setTimeout(()=>console.log(R),L);let H=window.setTimeout(()=>{this._buttplugOperator.SendLinearMsg(c.ButtPosition,c.Duration)},L);this._timerIDs.add(H),setTimeout(()=>{this._timerIDs.delete(H)},3e3)})}};var De=class{Player=document.getElementById("player");MediaNameSpan=document.getElementById("mediaNameSpan");OffsetInput=document.getElementById("offset");UFOTWsettingli=document.getElementsByClassName("UFOTWsettingli");UFOTWreverseLRCheckbox=document.getElementById("UFOTWreverseLRCheckbox");VorzeSAScriptToUFOTWCheckbox=document.getElementById("VorzeSAScriptToUFOTWCheckbox");VibDeviceList=document.getElementById("VibDeviceList");RotatorDeviceList=document.getElementById("RotatorDeviceList");LinearDeviceList=document.getElementById("LinearDeviceList");UFOTWDeviceList=document.getElementById("UFOTWDeviceList");TimeRoterScriptList=document.getElementById("TimeRoterScriptList");VorzeSAScriptList=document.getElementById("VorzeSAScriptList");FunscriptList=document.getElementById("FunscriptList");UFOTWScriptList=document.getElementById("UFOTWScriptList");ScriptInput=document.getElementById("scriptInput");MediaInput=document.getElementById("mediaInput");ConnectServerButton=document.getElementById("connectServerButton");ConnectDeviceButton=document.getElementById("connectDeviceButton");ConnectStatusSpan=document.getElementById("connectStatus");FunscriptSlider;AppendToList(e,n){let s=document.createElement("li"),o=document.createElement("span");return o.className="name",o.innerText=n,s.appendChild(o),e.appendChild(s),s}AppendVibDeviceList(e){this.AppendToList(this.VibDeviceList,e)}AppendRotatorDeviceList(e){this.AppendToList(this.RotatorDeviceList,e)}AppendLinearDeviceList(e){this.AppendToList(this.LinearDeviceList,e)}AppendUFOTWDeviceList(e){this.AppendToList(this.UFOTWDeviceList,e)}AppendTimeRoterScriptList(e){this.AppendToList(this.TimeRoterScriptList,e)}AppendVorzeSAScriptList(e){this.AppendToList(this.VorzeSAScriptList,e)}AppendUFOTWScriptList(e){this.AppendToList(this.UFOTWScriptList,e)}AppendFunscriptList(e){let n=this.AppendToList(this.FunscriptList,e),s=document.createElement("slider-container");n.appendChild(s),s.InitializeSlider(),this.FunscriptSlider=s}ClearDeviceLists(){this.VibDeviceList.innerHTML="",this.RotatorDeviceList.innerHTML="",this.LinearDeviceList.innerHTML=""}ClearScriptLists(){this.TimeRoterScriptList.innerHTML="",this.VorzeSAScriptList.innerHTML="",this.FunscriptList.innerHTML="",this.UFOTWScriptList.innerHTML=""}AddFunscriptSliderUpdateEvent(e){let n=this.FunscriptSlider;n?.addEventListener("mouseup",()=>{e(n.range_min,n.range_max)})}};var Ee=class{ButtplugOperator;ScriptOperator;UI;constructor(){this.ButtplugOperator=new Me,this.ScriptOperator=new xe(this.ButtplugOperator),this.UI=new De,this.addEvents()}async ConnectWasm(){let e=this.UI.ConnectStatusSpan;e.innerText="Buttplug\u6E96\u5099\u4E2D..",await this.ButtplugOperator.connectWasm()?e.innerText="Buttplug\u6E96\u5099\u5B8C\u4E86":e.innerText="Buttplug\u6E96\u5099\u306B\u5931\u6557\u3057\u307E\u3057\u305F"}async ConnectServer(){let e=document.getElementById("serverURL"),n=this.UI.ConnectStatusSpan;n.innerText="\u63A5\u7D9A\u4E2D...",await this.ButtplugOperator.connectWebsocket("ws://"+e.value)?n.innerText="\u63A5\u7D9A\u6210\u529F: "+e.value:n.innerText="\u63A5\u7D9A\u5931\u6557"}RefleshDeviceLists(){let e=this.UI;e.ClearDeviceLists();for(let n of this.ButtplugOperator.Devices.Viberators)e.AppendVibDeviceList(n.name);for(let n of this.ButtplugOperator.Devices.Rotators)e.AppendRotatorDeviceList(n.name);for(let n of this.ButtplugOperator.Devices.Linears)e.AppendLinearDeviceList(n.name);if(this.ButtplugOperator.Devices.UFOTW.length>0){for(let n of this.ButtplugOperator.Devices.UFOTW)e.AppendUFOTWDeviceList(n.name);for(let n of e.UFOTWsettingli)n.style.display="list-item"}else for(let n of e.UFOTWsettingli)n.style.display="none"}RefleshScriptLists(){let e=this.UI;e.ClearScriptLists();let n=this.ScriptOperator.Scripts.TimeRoter,s=this.ScriptOperator.Scripts.Vorze_SA,o=this.ScriptOperator.Scripts.Funscript,c=this.ScriptOperator.Scripts.UFOTW;n&&e.AppendTimeRoterScriptList(n.Title),s&&e.AppendVorzeSAScriptList(s.Title),c&&e.AppendUFOTWScriptList(c.Title),o&&(e.AppendFunscriptList(o.Title),e.FunscriptSlider.range_min=o.RangedMin,e.FunscriptSlider.range_max=o.RangedMax,e.FunscriptSlider.addEventListener("mouseup",()=>{let L=e.FunscriptSlider.range_min,R=e.FunscriptSlider.range_max;o.SetRange(L,R)}))}LoadScript(){let e=this.UI.ScriptInput.files[0];if(e!=null){let n=new FileReader;n.readAsText(e),n.onload=()=>{n.result&&this.ScriptOperator.LoadScript(n.result,e.name)&&this.RefleshScriptLists()},n.onerror=()=>{console.log(n.error)}}}LoadMedia(){let e=this.UI,n=e.MediaInput.files;n&&(n[0].type.startsWith("video/")?(e.Player.src=URL.createObjectURL(n[0]),e.Player.style.height="auto",e.MediaNameSpan.innerText=n[0].name):n[0].type.startsWith("audio/")?(e.Player.src=URL.createObjectURL(n[0]),e.Player.style.height="3em",e.MediaNameSpan.innerText=n[0].name):e.MediaNameSpan.innerText="\u3053\u306E\u30D5\u30A1\u30A4\u30EB\u306F\u518D\u751F\u3067\u304D\u307E\u305B\u3093: "+n[0].name,e.MediaInput.files=null)}addEvents(){console.log("addEvent() called.");let e=this.UI;e.Player.addEventListener("timeupdate",()=>{e.Player.paused||this.ScriptOperator.TimeUpdate(e.Player.currentTime)}),e.Player.addEventListener("pause",()=>this.ScriptOperator.Stop()),e.Player.addEventListener("ended",()=>this.ScriptOperator.Stop()),e.ScriptInput.addEventListener("input",()=>{this.LoadScript()}),document.getElementById("scriptButton").addEventListener("click",()=>{e.ScriptInput?.click()}),e.MediaInput.addEventListener("input",()=>{this.LoadMedia()}),document.getElementById("mediaButton")?.addEventListener("click",()=>{e.MediaInput.click()}),e.UFOTWreverseLRCheckbox.addEventListener("change",()=>{this.ButtplugOperator.UFOTWReverseLR=this.UI.UFOTWreverseLRCheckbox.checked}),e.VorzeSAScriptToUFOTWCheckbox.addEventListener("change",()=>{this.ScriptOperator.VorzeSAScriptToUFOTW=this.UI.VorzeSAScriptToUFOTWCheckbox.checked}),e.OffsetInput.addEventListener("change",()=>{this.ScriptOperator.Offset=Number(e.OffsetInput.value)}),e.ConnectDeviceButton.addEventListener("click",async()=>{await this.ButtplugOperator.ConnectDevice()}),e.ConnectServerButton!=null?e.ConnectServerButton?.addEventListener("click",async()=>this.ConnectServer()):this.ConnectWasm(),this.ButtplugOperator.AddDevicesRefleshedEvents(()=>this.RefleshDeviceLists())}};(()=>{var u=Object.defineProperty,e=Math.pow,n=(t,i,a)=>i in t?u(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,s=(t,i,a)=>(n(t,typeof i!="symbol"?i+"":i,a),a),o=(t,i)=>` ${i&&i.length>0?i.map(a=>`<link rel="stylesheet" href="${a}" />`).join(""):""} <style> ${t} </style> <div class="range-slider-box"> <div class="row"> <div id="range-slider" class="range-slider"> <div class="container"> <div class="panel"></div> <div class="panel-fill"></div> <div class="container"> <div class="pointer" tabindex="0" role="slider"> <div class="pointer-shape"></div> </div> </div> </div> </div> </div> </div>`,c=":host{--width:300px;--height:.25rem;--opacity:.4;--panel-bg:#cbd5e1;--panel-bg-hover:#94a3b8;--panel-bg-fill:#475569;--panel-bg-border-radius:1rem;--pointer-width:1rem;--pointer-height:1rem;--pointer-bg:#fff;--pointer-bg-hover:#dcdcdc;--pointer-bg-focus:#dcdcdc;--pointer-shadow:0 0 2px rgba(0,0,0,0.8);--pointer-shadow-hover:0 0 2px #000;--pointer-shadow-focus:var(--pointer-shadow-hover);--pointer-border:1px solid hsla(0,0%,88%,0.5);--pointer-border-hover:1px solid #94a3b8;--pointer-border-focus:var(--pointer-border-hover);--pointer-border-radius:100%;--animate-onclick:.3s}:host{max-width:100%}.range-slider-box{display:flex;position:relative;flex-direction:column}.range-slider{position:relative;width:var(--width,100%);height:var(--height,0.25rem);touch-action:none;max-width:100%;box-sizing:border-box;cursor:pointer}.row{width:100%;display:flex;align-items:center}.range-slider.disabled{opacity:var(--opacity,0.4);cursor:default}.pointer.disabled{-webkit-filter:brightness(0.8);filter:brightness(0.8);cursor:default}.range-slider *{box-sizing:border-box}.container{position:absolute;width:100%;height:100%}.panel{position:absolute;z-index:10;width:100%;height:100%;background:var(--panel-bg,#2d4373);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;transition:.3s all ease}.panel-fill{background:var(--panel-bg-fill,#000);border-radius:var(--panel-bg-border-radius,1rem);overflow:hidden;height:100%;position:absolute;z-index:10}.panel:hover{background:var(--panel-bg-hover,#5f79b7)}.disabled .panel:hover{background:var(--panel-bg,#5f79b7)}.pointer{position:absolute;z-index:20;outline:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;box-shadow:var(--pointer-shadow);border:var(--pointer-border);border-radius:var(--pointer-border-radius,100%);-webkit-transform:translateX(-50%);transform:translateX(-50%);width:var(--pointer-width,15px);height:var(--pointer-height,15px);transition:.3s all ease}.pointer-shape:hover{background:var(--pointer-bg-hover,#fff);background-size:contain;border:var(--pointer-border-hover);box-shadow:var(--pointer-shadow-hover)}.disabled .pointer-shape:hover{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.pointer:focus .pointer-shape{background:var(--pointer-bg-focus,#fff);background-size:contain;border:var(--pointer-border-focus);box-shadow:var(--pointer-shadow-focus)}.disabled .pointer:focus .pointer-shape{background:var(--pointer-bg,#fff);background-size:contain;border:var(--pointer-border);box-shadow:var(--pointer-shadow)}.type-vertical .range-slider{--width:.25rem;--height:300px;max-height:100%}.type-vertical .range-slider .pointer{left:50%}.type-vertical .range-slider .panel-fill{width:100%}.type-vertical.range-slider-box{flex-direction:row}.type-vertical .row{flex-direction:column}.animate-on-click .pointer,.animate-on-click .panel-fill{transition:all var(--animate-onclick)}.range-dragging .panel-fill{cursor:move}",L="pointers-overlap",R="pointers-min-distance",H="pointers-max-distance",J="range-dragging",X="data",ce="min",lt="max",at="step",dt="round",ct="type",ut="theme",pt="rtl",ht="btt",gt="disabled",mt="keyboard-disabled",vt="mousewheel-disabled",sr="slider-width",or="slider-height",lr="slider-radius",ar="slider-bg",dr="slider-bg-hover",cr="slider-bg-fill",ur="pointer-width",pr="pointer-height",hr="pointer-radius",gr="pointer-bg",mr="pointer-bg-hover",vr="pointer-bg-focus",fr="pointer-shadow",br="pointer-shadow-hover",Sr="pointer-shadow-focus",Lr="pointer-border",yr="pointer-border-hover",wr="pointer-border-focus",ft="animate-onclick",Mr="css-links",N="vertical",re="horizontal",Ce=(t,i,a,l,p)=>{let f=i-t;return f===0?a:(l-a)*(p-t)/f+a},G=t=>!isNaN(parseFloat(t))&&isFinite(t),F=(t,i)=>G(t)?Number(t):i,bt=(t,i)=>i===0?0:Math.round(t/i)*i,Tr=(t,i=1/0)=>{if(i===1/0)return t;let a=e(10,i);return Math.round(t*a)/a},_=t=>t==null?!1:typeof t=="boolean"?t:t.trim().toLowerCase()==="true",Or=(t,i)=>{t.dispatchEvent(new CustomEvent("onPointerClicked",{detail:{$pointer:i}}))},xr=(t,i)=>{t.dispatchEvent(new CustomEvent("onMouseDown",{detail:{nativeEvent:i}}))},Dr=(t,i)=>{t.dispatchEvent(new CustomEvent("onMouseUp",{detail:{nativeEvent:i}}))},Er=(t,i)=>{t.dispatchEvent(new CustomEvent("onKeyDown",{detail:{nativeEvent:i}}))},Rr=(t,i)=>{if(!i||i.length<=0)return;let a=i.map(p=>G(p)?F(p,p):p),l={values:a||[]};l.value=a[0],l.value0=a[0],l.value1=a[0];for(let p=1;p<a.length;p++)l[`value${p+1}`]=a[p];t.dispatchEvent(new CustomEvent("change",{detail:l}))},ke=(t,i,a)=>{let l=0,p,f,y,h,g=!1,w=(S,E,$,B,C,k)=>{let I=l;$!==void 0&&S>$&&(S=$),E!==void 0&&S<E&&(S=E),l=S;let W=l;return(B===N&&k||B===re&&C)&&(W=100-W),B===N?i.style.top=`${W}%`:i.style.left=`${W}%`,I!==l},T=S=>S===i||i.contains(S),v=(S,E,$,B)=>{p=S,f=E,y=$,h=B},x=S=>{g=S,i.classList.toggle("disabled",g),g?i.setAttribute("aria-disabled","true"):i.hasAttribute("aria-disabled")&&i.removeAttribute("aria-disabled")},z=(S,E)=>{E==null?i.removeAttribute(S):i.setAttribute(S,E)},U=S=>i.getAttribute(S),b=S=>{if(!g){switch(S.key){case"ArrowLeft":{S.preventDefault(),typeof p=="function"&&p(a);break}case"ArrowRight":{S.preventDefault(),typeof f=="function"&&f(a);break}case"ArrowUp":{S.preventDefault(),typeof y=="function"&&y(a);break}case"ArrowDown":{S.preventDefault(),typeof h=="function"&&h(a);break}}Er(t,S)}},M=()=>{g||Or(t,i)};return i.className=`pointer pointer-${a}`,i.addEventListener("keydown",b),i.addEventListener("click",M),{$pointer:i,get percent(){return l},get disabled(){return g},set disabled(S){x(S)},updatePosition:w,isClicked:T,setCallbacks:v,setAttr:z,getAttr:U,destroy:()=>{i.removeEventListener("keydown",b),i.removeEventListener("click",M),i.remove()}}},Cr=t=>{if(t==null)return;if(Array.isArray(t))return t;if(t.trim()==="")return;let i=t.split(","),a=[],l=!0;for(let p=0;p<i.length;p++){let f=i[p].trim();f!==""&&(a.push(f),G(f)||(l=!1))}return l?a.map(p=>Number(p)):a},kr=(t,i)=>i?i.findIndex(a=>a===t||a.toString().trim()===t.toString().trim()):-1,Ar=t=>({updatePosition:(i,a,l,p)=>{if(a.length<=0)return;let f=a.length===1,y=a[0],h=a[a.length-1];i===N?(t.style.removeProperty("width"),t.style.removeProperty("right"),t.style.removeProperty("left"),f?t.style.height=`${y}%`:t.style.height=`${Math.abs(y-h)}%`,p?(t.style.bottom="0%",f?t.style.top="auto":t.style.top=`${Math.min(100-h,100-y)}%`):(t.style.bottom="auto",f?t.style.top="0%":t.style.top=`${Math.min(y,h)}%`)):(t.style.removeProperty("height"),t.style.removeProperty("top"),t.style.removeProperty("bottom"),f?t.style.width=`${y}%`:t.style.width=`${Math.abs(y-h)}%`,l?(t.style.right="0%",f?t.style.left="auto":t.style.left=`${Math.min(100-h,100-y)}%`):(t.style.right="auto",f?t.style.left="0%":t.style.left=`${Math.min(y,h)}%`))}}),St="--animate-onclick",Fr="--width",Br="--height",Pr="--panel-bg-border-radius",$r="--panel-bg",_r="--panel-bg-hover",Ur="--panel-bg-fill",Hr="--pointer-width",Ir="--pointer-height",Wr="--pointer-border-radius",Vr="--pointer-bg",zr="--pointer-bg-hover",Nr="--pointer-bg-focus",jr="--pointer-shadow",qr="--pointer-shadow-hover",Jr="--pointer-shadow-focus",Yr="--pointer-border",Gr="--pointer-border-hover",Kr="--pointer-border-focus",ue=(t,i,a)=>{let l=new Map;for(let p of t.attributes){let f=p.nodeName.trim().toLowerCase();if(!i.test(f))continue;let y=f.replace(/\D/g,"").trim(),h=y===""||y==="0"||y==="1"?0:F(y,0)-1,g=a&&typeof a=="function"?a(p.value):p.value;l.set(h,g)}return l},Xr=t=>{if(!t)return null;let i=t.getAttribute(Mr);if(!i)return null;let a=i.split(";"),l=[];for(let p of a)p.trim()!==""&&l.push(p.trim());return l},Lt=[[Fr,sr,"sliderWidth",null],[Br,or,"sliderHeight",null],[Pr,lr,"sliderRadius",null],[$r,ar,"sliderBg",null],[_r,dr,"sliderBgHover",null],[Ur,cr,"sliderBgFill",null],[Hr,ur,"pointer#Width",/^pointer([0-9]*)-width$/],[Ir,pr,"pointer#Height",/^pointer([0-9]*)-height$/],[Wr,hr,"pointer#Radius",/^pointer([0-9]*)-radius$/],[Vr,gr,"pointer#Bg",/^pointer([0-9]*)-bg$/],[zr,mr,"pointer#BgHover",/^pointer([0-9]*)-bg-hover$/],[Nr,vr,"pointer#BgFocus",/^pointer([0-9]*)-bg-focus$/],[jr,fr,"pointer#Shadow",/^pointer([0-9]*)-shadow$/],[qr,br,"pointer#ShadowHover",/^pointer([0-9]*)-shadow-hover$/],[Jr,Sr,"pointer#ShadowFocus",/^pointer([0-9]*)-shadow-focus$/],[Yr,Lr,"pointer#Border",/^pointer([0-9]*)-border$/],[Gr,yr,"pointer#BorderHover",/^pointer([0-9]*)-border-hover$/],[Kr,wr,"pointer#BorderFocus",/^pointer([0-9]*)-border-focus$/]],Qr=(t,i,a)=>{let l=null,p=[],f=new Map,y=(b,M=i)=>{let S=[...M.classList];for(let E of S)E.startsWith(b)&&i.classList.remove(E)},h=()=>{y("shape");let b=i.querySelectorAll(".pointer");for(let M of b)y("shape",M)},g=b=>{l=b,y("theme-"),typeof b=="string"&&i.classList.add(`theme-${b}`)},w=()=>{if(h(),!(p.length<=0)){i.classList.add("shape",`shape-${p[0]}`);for(let b=1;b<p.length;b++){let M=p[b];if(!M)continue;let S=i.querySelector(`.pointer-${b}`);!S||S.classList.add("shape",`shape-${M}`)}}},T=(b,M)=>{p[b]=M,w()},v=()=>{h();let b=ue(t,/^pointer([0-9]*)-shape$/);if(!(b.size<=0)){for(let M of b){let S=M[0];p[S]=M[1]}w()}},x=(b,M)=>`${b}-${M}`,z=(b,M,S)=>{let E=a[S];if(!E)return;let $=S===0?i:E.$pointer;if(M==null){f.has(x(b,S))&&f.delete(x(b,S)),$.style.removeProperty(b);return}f.set(x(b,S),M),$.style.setProperty(b,M)},U=(b,M)=>f.get(x(b,M));return(()=>{for(let b of Lt){let[M,S,E,$]=b;if($){let C=ue(t,$);for(let k of C){let I=k[0],W=k[1];z(M,W,I)}}else{let C=t.getAttribute(S);z(M,C,0)}let B=[];if(E.indexOf("#")===-1)B.push([E,0]);else{B.push([E.replace("#",""),0]),B.push([E.replace("#","0"),0]),B.push([E.replace("#","1"),0]);for(let C=1;C<a.length;C++)B.push([E.replace("#",(C+1).toString()),C])}for(let C of B)try{let k=C[0],I=C[1];Object.prototype.hasOwnProperty.call(t,k)||Object.defineProperty(t,k,{get(){return U(M,I)},set:W=>{z(M,W,I)}})}catch(k){console.error(k)}}g(t.getAttribute(ut)),v()})(),{setStyle:z,getStyle:U,get theme(){return l},set theme(b){g(b)},get pointerShapes(){return p},setPointerShape:T}},ie="animate-on-click",yt="range-dragging",Zr=(t,i,a,l)=>{let p=[],f=T=>{for(let v of p)v.update&&typeof v.update=="function"&&v.update(T)},y=()=>{for(let T of p)T.destroy&&typeof T.destroy=="function"&&T.destroy()},h=(T,v)=>{for(let x of p)x.onAttrChange&&typeof x.onAttrChange=="function"&&x.onAttrChange(T,v)},g=T=>{if(T.gettersAndSetters){for(let v of T.gettersAndSetters)if(!(!v.name||!v.attributes))try{Object.prototype.hasOwnProperty.call(t,v.name)||Object.defineProperty(t,v.name,v.attributes)}catch(x){console.error("defineSettersGetters error:",x)}}},w=T=>{var v;if(!T.css)return;let x=(v=t.shadowRoot)==null?void 0:v.querySelector("style");!x||(x.innerHTML+=T.css)};return{init:()=>{if(window.tcRangeSliderPlugins)for(let T of window.tcRangeSliderPlugins){let v=T();p.push(v),v.init&&typeof v.init=="function"&&(v.init(t,i,a,l),g(v),w(v))}},update:f,onAttrChange:h,destroy:y}},ei=10,wt=20,ti=(t,i)=>{let a=new Map,l=/^value([0-9]*)$/;for(let h of t.attributes){let g=h.nodeName.trim().toLowerCase();if(!l.test(g))continue;let w=g.replace("value","").trim(),T=w===""||w==="0"||w==="1"?0:F(w,0)-1,v=G(h.value)?F(h.value,0):h.value;a.set(T,v)}let p=Math.max(...Array.from(a.keys())),f=[];f.push([ke(t,i,0),a.get(0)]);let y=i;for(let h=1;h<=p;h++){let g=i.cloneNode(!0);y.after(g),y=g,f.push([ke(t,g,h),a.get(h)])}return f},Mt=(t,i,a,l,p,f,y)=>{try{Object.defineProperty(t,l,{configurable:!0,get(){if(!i)return;let h=i.pointers[a];if(!h)return;let g=i.getTextValue(h.percent);return G(g)?F(g,g):g},set:h=>{i.pointers[a]?i?.setValue(h,a):i?.addPointer(h)}}),Object.defineProperty(t,p,{configurable:!0,get(){var h,g;return(g=(h=i?.pointers[a])==null?void 0:h.getAttr("aria-label"))!=null?g:void 0},set:h=>{!i||i.setAriaLabel(a,h)}}),Object.defineProperty(t,f,{configurable:!0,get(){var h,g;return(g=(h=i?.styles)==null?void 0:h.pointerShapes[a])!=null?g:null},set:h=>{!i||!i.styles||i.styles.setPointerShape(a,h)}}),Object.defineProperty(t,y,{configurable:!0,get(){var h;return(h=i?.pointers[a].disabled)!=null?h:!1},set:h=>{if(!i)return;let g=i?.pointers[a];!g||(g.disabled=h)}})}catch(h){console.error(h)}},ri=(t,i)=>{let a=[["value","ariaLabel","pointerShape","pointerDisabled",0],["value0","ariaLabel0","pointerShape0","pointer0Disabled",0],["value1","ariaLabel1","pointerShape1","pointer1Disabled",0]];for(let l=2;l<ei;l++)a.push([`value${l}`,`ariaLabel${l}`,`pointer${l}Shape`,`pointer${l}Disabled`,l-1]);for(let l of a)Mt(t,i,l[4],l[0],l[1],l[2],l[3])},Tt=(t,i,a)=>{var l;let p=(l=a.shadowRoot)==null?void 0:l.querySelector(".container");if(p)for(let f of t)i?p.prepend(f.$pointer):p.append(f.$pointer)},ii=(t,i)=>{if(!(!i||t.length<=1)){for(let a of t)a.$pointer.style.zIndex=wt.toString();i.$pointer.style.zIndex=(wt*2).toString()}},Ae=0,oe=100,ne=2,Ot="0.3s",ni=(t,i,a)=>{let l=a.map(r=>r[0]),p=null,f=null,y=null,h=null,g=Ae,w=oe,T,v,x=re,z=ne,U=!1,b=!1,M=!1,S=0,E=1/0,$=!1,B,C,k=!1,I=!1,W=!1,Q=Ot,xt=[],Dt=r=>{k||(r.preventDefault&&r.preventDefault(),ee(r),window.addEventListener("mousemove",ee),window.addEventListener("mouseup",pe),xr(t,r))},pe=r=>{k||(B=void 0,C=void 0,window.removeEventListener("mousemove",ee),window.removeEventListener("mouseup",pe),Q&&i.classList.add(ie),Dr(t,r))},li=(r,d)=>{if(l.length<=0)return;if(l.length===1)return l[0].isClicked(r)&&Q&&i.classList.remove(ie),l[0];let m=di(r);if($){let O=d,j=ge(O);j!==void 0&&(O=bt(O,j)),m?(B=O,C=0,Q&&i.classList.remove(ie)):B!==void 0&&(C=O-B,B=O)}if(!ai(r)&&!m){for(let O of l)if(!(!O.isClicked(r)||O.disabled))return Q&&i.classList.remove(ie),O;for(let O of l)if(p===O)return O}let D=1/0,A=null;for(let O of l){if(O.disabled)continue;let j=Math.abs(d-O.percent);j<D&&(D=j,A=O)}return A},Et=()=>l.findIndex(r=>p===r&&!r.disabled),ee=r=>{let d;if(x===N){let{height:D,top:A}=i.getBoundingClientRect(),O=r.type.indexOf("mouse")!==-1?r.clientY:r.touches[0].clientY;d=Math.min(Math.max(0,O-A),D)*100/D}else{let{width:D,left:A}=i.getBoundingClientRect(),O=r.type.indexOf("mouse")!==-1?r.clientX:r.touches[0].clientX;d=Math.min(Math.max(0,O-A),D)*100/D}if((U||b)&&(d=100-d),p=li(r.target,d),p&&ii(l,p),$&&l.length>1&&C!==void 0){let D=l[0],A=l[l.length-1],O=D.percent+C<0,j=A.percent+C>100;if(O||j)return;for(let we=0;we<l.length;we++)V(we,l[we].percent+C);return}let m=Et();m!==-1&&(V(m,d),p?.$pointer.focus())},he=r=>{if(k||document.activeElement!==t||p?.disabled)return;r.stopPropagation(),r.preventDefault();let d=r.deltaY<0,m=U||b,D=d?!m:m,A=Et();A!==-1&&(D?le(A,l[A].percent):ae(A,l[A].percent))},Rt=r=>{k||I||(x===N?b?V(r,100):V(r,0):U?ae(r,l[r].percent):le(r,l[r].percent))},Ct=r=>{k||I||(x===N?b?V(r,0):V(r,100):U?le(r,l[r].percent):ae(r,l[r].percent))},kt=r=>{k||I||(x===N?b?ae(r,l[r].percent):le(r,l[r].percent):U?V(r,100):V(r,0))},At=r=>{k||I||(x===N?b?le(r,l[r].percent):ae(r,l[r].percent):U?V(r,0):V(r,100))},ai=r=>r.classList.contains("panel"),di=r=>r.classList.contains("panel-fill"),le=(r,d)=>{if(d===void 0)return;let m=ge(d);m==null&&(m=1),d-=m,d<0&&(d=0),V(r,d)},ae=(r,d)=>{if(d===void 0)return;let m=ge(d);m==null&&(m=1),d+=m,d>100&&(d=100),V(r,d)},te=()=>{!h||h.update({percents:Ft(),values:Bt(),$pointers:Pt(),min:$t(),max:_t(),data:Pe(),step:Be(),round:_e(),type:$e(),textMin:me(),textMax:ve(),rightToLeft:Ie(),bottomToTop:We(),pointersOverlap:je(),pointersMinDistance:Ue(),pointersMaxDistance:He(),rangeDragging:qe(),disabled:Ve(),keyboardDisabled:ze(),mousewheelDisabled:Ne()})},ci=()=>{te()},ui=r=>{if(!(M||l.length<=1||w===g))if(r===0){let d=E*100/(w-g);return Math.max(0,l[r+1].percent-d)}else{let d=S*100/(w-g);return Math.min(l[r-1].percent+d,100)}},pi=r=>{if(!(M||l.length<=1||w===g))if(r===l.length-1){let d=E*100/(w-g);return Math.min(l[r-1].percent+d,100)}else{let d=S*100/(w-g);return Math.max(0,l[r+1].percent-d)}},ge=r=>{let d;if(typeof T=="function"){let m=Ce(0,100,g,w,r);d=T(m,r)}else d=T;if(G(d)){let m=w-g;return d=m===0?0:d*100/m,d}},se=r=>{if(r===void 0)return;let d=Ce(0,100,g,w,r);return v!==void 0?v[Math.round(d)]:Tr(d,z)},me=()=>v!==void 0?v[g]:g,ve=()=>v!==void 0?v[w]:w,Be=()=>T,hi=r=>{var d;return r<=0||M?me():(d=se(l[r-1].percent))!=null?d:""},gi=r=>{var d;return l.length<=1||r>=l.length-1||M?ve():(d=se(l[r+1].percent))!=null?d:""},Ft=()=>l.map(r=>r.percent),Bt=()=>l.map(r=>se(r.percent)),Pt=()=>l.map(r=>r.$pointer),$t=()=>g,_t=()=>w,Pe=()=>v,$e=()=>x,_e=()=>z,Ue=()=>S,He=()=>E,mi=r=>xt[r],Ie=()=>U,We=()=>b,Ve=()=>k,ze=()=>I,Ne=()=>W,je=()=>M,qe=()=>$,V=(r,d)=>{if(d===void 0)return;let m=ge(d);m!==void 0&&(d=bt(d,m));let D=l[r];if(!D)return;let A=D.updatePosition(d,ui(r),pi(r),x,U,b);f?.updatePosition(x,l.map(O=>O.percent),U,b),te();for(let O of l){let j=se(O.percent);j!==void 0&&(O.setAttr("aria-valuenow",j.toString()),O.setAttr("aria-valuetext",j.toString()))}fi(),A&&Rr(t,l.map(O=>se(O.percent)))},Y=()=>{for(let r=0;r<l.length;r++)V(r,l[r].percent)},vi=(r,d)=>{g=v!==void 0?0:F(r,Ae),w=v!==void 0?v.length-1:F(d,oe),fe(g),be(w)},fi=()=>{var r,d;for(let m=0;m<l.length;m++){let D=l[m];D.setAttr("aria-valuemin",((r=hi(m))!=null?r:"").toString()),D.setAttr("aria-valuemax",((d=gi(m))!=null?d:"").toString())}},fe=r=>{g=F(r,Ae),g>w&&(w=g+oe),Y()},be=r=>{w=F(r,oe),w<g&&(w=g+oe),Y()},Ut=r=>{M=!0;for(let d=0;d<r.length;d++)Se(r[d],d);M=!1;for(let d=0;d<r.length;d++)Se(r[d],d)},Se=(r,d)=>{let m;v!==void 0?(m=r==null?0:kr(r,v),m===-1&&(m=0)):(m=F(r,g),m<g&&(m=g),m>w&&(m=w));let D=Ce(g,w,0,100,m);V(d,D)},Le=r=>{if(r==null){T=void 0;return}if(typeof r=="function"){T=r,Y();return}if(G(r)){T=F(r,1);let d=Math.abs(w-g);T>d&&(T=void 0),Y();return}T=void 0},Je=r=>{M=r,Y()},Ye=r=>{(!G(r)||r<0)&&(r=0),S=r},Ge=r=>{(!G(r)||r<0)&&(r=1/0),E=r},Ke=r=>{k=r,i.classList.toggle("disabled",k),k?i.setAttribute("aria-disabled","true"):i.hasAttribute("aria-disabled")&&i.removeAttribute("aria-disabled")},Ht=r=>{I=r},It=r=>{W=r,W?document.removeEventListener("wheel",he):document.addEventListener("wheel",he,{passive:!1})},Xe=r=>{if(r==null){v=void 0;return}if(v=Cr(r),v===void 0||v.length<=0){v=void 0;return}fe(0),be(v.length-1),T===void 0&&Le(1)},Qe=r=>{var d;typeof r=="string"?x=r.trim().toLowerCase()===N?N:re:x=re;let m=(d=t.shadowRoot)==null?void 0:d.querySelector(".range-slider-box");if(!m)return;m.className=`range-slider-box type-${x}`,Y();let D=x===N?"vertical":"horizontal";for(let A of l)A.setAttr("aria-orientation",D)},Ze=r=>{U=r,l.length>1&&Tt(l,U,t),Y(),te()},et=r=>{b=r,l.length>1&&Tt(l,b,t),Y(),te()},tt=r=>{z=F(r,ne),z<0&&(z=ne),te()},Wt=r=>{r==null||r.toString().trim().toLowerCase()==="false"?(Q=void 0,i.style.removeProperty(St),i.classList.remove(ie)):(Q=r.toString(),i.style.setProperty(St,Q),i.classList.add(ie))},Vt=(r,d)=>{let m=l[r];!m||(m.setAttr("aria-label",d),xt[r]=d)},ye=r=>{if(B=void 0,l.length<=1){$=!1,i.classList.remove(yt);return}$=r,i.classList.toggle(yt,$)},bi=()=>{Ke(_(t.getAttribute(gt))),I=_(t.getAttribute(mt)),W=_(t.getAttribute(vt));let r=ue(t,/^pointer([0-9]*)-disabled$/,d=>_(d));for(let d of r){let m=d[0];!l[m]||(l[m].disabled=d[1])}},Si=()=>{let r=ue(t,/^aria-label([0-9]*)$/);for(let d of r){let m=d[0];Vt(m,d[1])}},Li=r=>{let d=l.length,m=l[d-1].$pointer,D=m.cloneNode(!0);m.after(D);let A=ke(t,D,d);return A.setCallbacks(Rt,Ct,kt,At),l.push(A),Se(r,d),Y(),te(),d},yi=()=>{let r=l.length,d=l[r-1];return d?(d.destroy(),l.pop(),l.length<=1&&ye(!1),Y(),te(),r-1):-1};return(()=>{var r,d;for(let D of l)D.setCallbacks(Rt,Ct,kt,At);let m=(r=t.shadowRoot)==null?void 0:r.querySelector(".panel-fill");m&&(f=Ar(m)),Qe(t.getAttribute(ct)),Ze(_(t.getAttribute(pt))),et(_(t.getAttribute(ht))),vi(t.getAttribute(ce),t.getAttribute(lt)),Le(t.getAttribute(at)),Xe(t.getAttribute(X)),Ut(a.map(D=>D[1])),Je(_(t.getAttribute(L))),Ye(F(t.getAttribute(R),0)),Ge(F(t.getAttribute(H),1/0)),ye(_(t.getAttribute(J))),tt(F(t.getAttribute(dt),ne)),bi(),Si(),y=Qr(t,i,l),Wt((d=t.getAttribute(ft))!=null?d:Ot),i.addEventListener("mousedown",Dt),i.addEventListener("mouseup",pe),i.addEventListener("touchmove",ee),i.addEventListener("touchstart",ee),W||document.addEventListener("wheel",he,{passive:!1}),h=Zr(t,ci,{setValues:Ut,setMin:fe,setMax:be,setStep:Le,setPointersOverlap:Je,setPointersMinDistance:Ye,setPointersMaxDistance:Ge,setDisabled:Ke,setType:Qe,setRightToLeft:Ze,setBottomToTop:et,setRound:tt,setKeyboardDisabled:Ht,setMousewheelDisabled:It,setRangeDragging:ye,setData:Xe},{getPercents:Ft,getValues:Bt,getPointerElements:Pt,getMin:$t,getMax:_t,getStep:Be,getData:Pe,getType:$e,getRound:_e,getTextMin:me,getTextMax:ve,isRightToLeft:Ie,isBottomToTop:We,isDisabled:Ve,isKeyboardDisabled:ze,isMousewheelDisabled:Ne,isPointersOverlap:je,isRangeDraggingEnabled:qe,getPointersMinDistance:Ue,getPointersMaxDistance:He}),h.init()})(),{get pointers(){return l},get styles(){return y},get pluginsManager(){return h},get min(){return me()},get max(){return ve()},get step(){return Be()},get pointersOverlap(){return je()},set pointersOverlap(r){Je(r)},get pointersMinDistance(){return Ue()},set pointersMinDistance(r){Ye(r)},get pointersMaxDistance(){return He()},set pointersMaxDistance(r){Ge(r)},get disabled(){return Ve()},set disabled(r){Ke(r)},get data(){return Pe()},get type(){return $e()},set type(r){Qe(r)},get rightToLeft(){return Ie()},set rightToLeft(r){Ze(r)},get bottomToTop(){return We()},set bottomToTop(r){et(r)},get round(){return _e()},set round(r){tt(r)},get animateOnClick(){return Q},set animateOnClick(r){Wt(r)},get keyboardDisabled(){return ze()},set keyboardDisabled(r){Ht(r)},get mousewheelDisabled(){return Ne()},set mousewheelDisabled(r){It(r)},get rangeDragging(){return qe()},set rangeDragging(r){ye(r)},setMin:fe,setMax:be,setValue:Se,setStep:Le,setData:Xe,getTextValue:se,setAriaLabel:Vt,getAriaLabel:mi,addPointer:Li,removePointer:yi,destroy:()=>{i.removeEventListener("mousedown",Dt),i.removeEventListener("mouseup",pe),i.removeEventListener("touchmove",ee),i.removeEventListener("touchstart",ee),document.removeEventListener("wheel",he);for(let r of l)r.destroy();h?.destroy()}}},si=(t,i,a)=>{let l=Lt.find(([h,g,w,T])=>g.replace("#","")===i.replace(/\d+/g,""));if(l&&t.styles){let[h,g,w,T]=l,v=i.replace(/\D/g,"").trim(),x=v===""||v==="0"||v==="1"?0:F(v,0)-1;t.styles.setStyle(h,a,x);return}switch(t&&t.pluginsManager&&t.pluginsManager.onAttrChange(i,a),i){case ce:{t.setMin(a);break}case lt:{t.setMax(a);break}case at:{t.setStep(a);break}case L:{t.pointersOverlap=_(a);break}case R:{t.pointersMinDistance=F(a,0);break}case J:{t.rangeDragging=_(a);break}case H:{t.pointersMaxDistance=F(a,1/0);break}case gt:{t.disabled=_(a);break}case mt:{t.keyboardDisabled=_(a);break}case vt:{t.mousewheelDisabled=_(a);break}case X:{t.setData(a);break}case ct:{t.type=a;break}case pt:{t.rightToLeft=_(a);break}case ht:{t.bottomToTop=_(a);break}case dt:{t.round=F(a,ne);break}case ut:{t.styles&&(t.styles.theme=a);break}case ft:{t.animateOnClick=a;break}}let p=null;if(/^value([0-9]*)$/.test(i)&&(p="value"),/^pointer([0-9]*)-disabled$/.test(i)&&(p="pointer-disabled"),/^aria-label([0-9]*)$/.test(i)&&(p="aria-label"),/^pointer([0-9]*)-shape$/.test(i)&&(p="pointer-shape"),!p)return;let f=i.replace(/\D/g,"").trim(),y=f===""||f==="0"||f==="1"?0:F(f,0)-1;switch(p){case"value":{t.setValue(a,y);break}case"pointer-disabled":{let h=t?.pointers[y];if(!h)return;h.disabled=_(a);break}case"aria-label":{t.setAriaLabel(y,a);break}case"pointer-shape":{t.styles&&t.styles.setPointerShape(y,a);break}}},oi=class extends HTMLElement{constructor(){super(),s(this,"slider"),s(this,"_externalCSSList",[]),s(this,"_observer",null),this.attachShadow({mode:"open"})}set step(t){this.slider&&this.slider.setStep(t)}get step(){var t;return(t=this.slider)==null?void 0:t.step}set disabled(t){this.slider&&(this.slider.disabled=t)}get disabled(){var t,i;return(i=(t=this.slider)==null?void 0:t.disabled)!=null?i:!1}set data(t){var i;(i=this.slider)==null||i.setData(t)}get data(){var t;return(t=this.slider)==null?void 0:t.data}set min(t){var i;(i=this.slider)==null||i.setMin(t)}get min(){var t;return(t=this.slider)==null?void 0:t.min}set max(t){var i;(i=this.slider)==null||i.setMax(t)}get max(){var t;return(t=this.slider)==null?void 0:t.max}set round(t){!this.slider||(this.slider.round=t)}get round(){var t,i;return(i=(t=this.slider)==null?void 0:t.round)!=null?i:ne}set type(t){!this.slider||(this.slider.type=t??re)}get type(){var t;return((t=this.slider)==null?void 0:t.type)||re}set pointersOverlap(t){!this.slider||(this.slider.pointersOverlap=t)}get pointersOverlap(){var t,i;return(i=(t=this.slider)==null?void 0:t.pointersOverlap)!=null?i:!1}set pointersMinDistance(t){!this.slider||(this.slider.pointersMinDistance=t)}get pointersMinDistance(){var t,i;return(i=(t=this.slider)==null?void 0:t.pointersMinDistance)!=null?i:0}set pointersMaxDistance(t){!this.slider||(this.slider.pointersMaxDistance=t)}get pointersMaxDistance(){var t,i;return(i=(t=this.slider)==null?void 0:t.pointersMaxDistance)!=null?i:1/0}set theme(t){!this.slider||!this.slider.styles||(this.slider.styles.theme=t)}get theme(){var t,i,a;return(a=(i=(t=this.slider)==null?void 0:t.styles)==null?void 0:i.theme)!=null?a:null}set rtl(t){!this.slider||(this.slider.rightToLeft=t)}get rtl(){var t,i;return(i=(t=this.slider)==null?void 0:t.rightToLeft)!=null?i:!1}set btt(t){!this.slider||(this.slider.bottomToTop=t)}get btt(){var t,i;return(i=(t=this.slider)==null?void 0:t.bottomToTop)!=null?i:!1}set keyboardDisabled(t){!this.slider||(this.slider.keyboardDisabled=t)}get keyboardDisabled(){var t,i;return(i=(t=this.slider)==null?void 0:t.keyboardDisabled)!=null?i:!1}set mousewheelDisabled(t){!this.slider||(this.slider.mousewheelDisabled=t)}get mousewheelDisabled(){var t,i;return(i=(t=this.slider)==null?void 0:t.mousewheelDisabled)!=null?i:!1}set animateOnClick(t){!this.slider||(this.slider.animateOnClick=t)}get animateOnClick(){var t;return(t=this.slider)==null?void 0:t.animateOnClick}get rangeDragging(){var t,i;return(i=(t=this.slider)==null?void 0:t.rangeDragging)!=null?i:!1}set rangeDragging(t){this.slider&&(this.slider.rangeDragging=_(t))}get externalCSSList(){return this._externalCSSList}addPointer(t){var i,a;if(!this.slider)return;let l=(a=(i=this.slider)==null?void 0:i.addPointer(t))!=null?a:0;Mt(this,this.slider,l,`value${l+1}`,`ariaLabel${l+1}`,`pointerShape${l+1}`,`pointer${l+1}Disabled`)}removePointer(){var t;!this.slider||(t=this.slider)==null||t.removePointer()}addCSS(t){if(!this.shadowRoot)return;let i=document.createElement("style");i.textContent=t,this.shadowRoot.appendChild(i)}connectedCallback(){var t,i;if(!this.shadowRoot)return;this._externalCSSList=Xr(this),this.shadowRoot.innerHTML=o(c,this._externalCSSList);let a=(t=this.shadowRoot)==null?void 0:t.querySelector(".pointer");if(!a)return;let l=(i=this.shadowRoot)==null?void 0:i.getElementById("range-slider");if(!l)return;let p=ti(this,a);this.slider=ni(this,l,p),ri(this,this.slider),this._observer=new MutationObserver(f=>{f.forEach(y=>{var h;if(!this.slider||y.type!=="attributes")return;let g=y.attributeName;!g||si(this.slider,g,(h=this.getAttribute(g))!=null?h:"")})}),this._observer.observe(this,{attributes:!0})}disconnectedCallback(){this._observer&&this._observer.disconnect(),this.slider&&this.slider.destroy()}},Fe=oi;window.tcRangeSlider=Fe,customElements.get("toolcool-range-slider")||customElements.define("toolcool-range-slider",Fe),customElements.get("tc-range-slider")||customElements.define("tc-range-slider",class extends Fe{})})();var Re=class extends HTMLElement{get range_min(){return Number(this.slider.value1)}set range_min(e){this.slider.value1=e}get range_max(){return Number(this.slider.value2)}set range_max(e){this.slider.value2=e}slider;label_range_min;label_range_max;constructor(){super(),this.attachShadow({mode:"open"});let e=document.createElement("div"),n=document.createElement("span");n.textContent="\u79FB\u52D5\u7BC4\u56F2: ",e.appendChild(n);let s=document.createElement("span");s.textContent="0",e.appendChild(s),this.label_range_min=s;let o=document.createElement("tc-range-slider");o.style.padding="0 1em",o.style.display="inline-block",e.appendChild(o),this.slider=o;let c=document.createElement("span");s.textContent="100",e.appendChild(c),this.label_range_max=c,this.shadowRoot?.append(e),this.slider.addEventListener("change",L=>{this.label_range_min.textContent=String(this.slider.value1),this.label_range_max.textContent=String(this.slider.value2)}),this.slider.addEventListener("mouseup",L=>{console.log(`min: ${this.range_min}, max: ${this.range_max}`)})}InitializeSlider(){this.slider.min=0,this.slider.max=100,this.slider.step=1,this.slider.value1=0,this.slider.value2=100,this.slider.sliderWidth="200px",this.slider.style.padding="0 1em"}};customElements.define("slider-container",Re);var Hi;async function Ii(){console.log("main loaded."),Hi=new Ee}window.onload=Ii;
